<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Todoyu: C:/Programme/xampp/htdocs/todoyu2/ext/user/model/TodoyuUserManager.class.php Quellcode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Erzeugt von Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Hauptseite</span></a></li>
      <li><a href="pages.html"><span>Zus√§tzliche&nbsp;Informationen</span></a></li>
      <li><a href="namespaces.html"><span>Namensbereiche</span></a></li>
      <li><a href="annotated.html"><span>Datenstrukturen</span></a></li>
      <li class="current"><a href="files.html"><span>Dateien</span></a></li>
      <li><a href="examples.html"><span>Beispiele</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>Auflistung&nbsp;der&nbsp;Dateien</span></a></li>
      <li><a href="globals.html"><span>Datei-Elemente</span></a></li>
    </ul>
  </div>
<h1>C:/Programme/xampp/htdocs/todoyu2/ext/user/model/TodoyuUserManager.class.php</h1><a href="_todoyu_user_manager_8class_8php.html">gehe zur Dokumentation dieser Datei</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/***************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">*  Copyright notice</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">*  (c) 2009 snowflake productions gmbh</span>
<a name="l00006"></a>00006 <span class="comment">*  All rights reserved</span>
<a name="l00007"></a>00007 <span class="comment">*</span>
<a name="l00008"></a>00008 <span class="comment">*  This script is part of the todoyu project.</span>
<a name="l00009"></a>00009 <span class="comment">*  The todoyu project is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment">*  it under the terms of the GNU General Public License, version 2,</span>
<a name="l00011"></a>00011 <span class="comment">*  (http://www.gnu.org/licenses/old-licenses/gpl-2.0.html) as published by</span>
<a name="l00012"></a>00012 <span class="comment">*  the Free Software Foundation;</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*  This script is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">*  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<a name="l00017"></a>00017 <span class="comment">*  GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment">*</span>
<a name="l00019"></a>00019 <span class="comment">*  This copyright notice MUST APPEAR in all copies of the script!</span>
<a name="l00020"></a>00020 <span class="comment">***************************************************************/</span>
<a name="l00021"></a>00021 
<a name="l00029"></a><a class="code" href="class_todoyu_user_manager.html">00029</a> <span class="keyword">class </span><a class="code" href="class_todoyu_user_manager.html">TodoyuUserManager</a> {
<a name="l00030"></a>00030 
<a name="l00035"></a><a class="code" href="class_todoyu_user_manager.html#adf62e2b172196282218b1ece3d200fa1">00035</a>     <span class="keyword">const</span> <a class="code" href="class_todoyu_user_manager.html#adf62e2b172196282218b1ece3d200fa1">TABLE</a> = <span class="stringliteral">&apos;ext_user_user&apos;</span>;
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 
<a name="l00045"></a><a class="code" href="class_todoyu_user_manager.html#a781fc7372acdae4fa54609f7893f7b7a">00045</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a781fc7372acdae4fa54609f7893f7b7a">getUser</a>($idUser) {
<a name="l00046"></a>00046         $idUser = intval($idUser);
<a name="l00047"></a>00047 
<a name="l00048"></a>00048         <span class="keywordflow">return</span> <a class="code" href="class_todoyu_cache.html#ac4ee8343209de75d7fc2392648f4072b">TodoyuCache::getRecord</a>(<span class="stringliteral">&apos;TodoyuUser&apos;</span>, intval($idUser));
<a name="l00049"></a>00049     }
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 
<a name="l00059"></a><a class="code" href="class_todoyu_user_manager.html#a83676b6b5bc43a6f1077a7b5544194f1">00059</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a83676b6b5bc43a6f1077a7b5544194f1">getUserArray</a>($idUser) {
<a name="l00060"></a>00060         $idUser = intval($idUser);
<a name="l00061"></a>00061 
<a name="l00062"></a>00062         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getRecord(self::TABLE, $idUser);
<a name="l00063"></a>00063     }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 
<a name="l00073"></a><a class="code" href="class_todoyu_user_manager.html#a86bd2180ce817416390cd0aedd17a5c3">00073</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a86bd2180ce817416390cd0aedd17a5c3">getAllUsers</a>(array <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = array()) {
<a name="l00074"></a>00074         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="keyword">sizeof</span>(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>) === 0 ? <span class="charliteral">&apos;*&apos;</span> : implode(<span class="charliteral">&apos;,&apos;</span>, <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;escapeArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>));
<a name="l00075"></a>00075         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = self::TABLE;
<a name="l00076"></a>00076         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos;deleted = 0&apos;</span>;
<a name="l00077"></a>00077         $order  = <span class="stringliteral">&apos;lastname, firstname&apos;</span>;
<a name="l00078"></a>00078 
<a name="l00079"></a>00079         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, <span class="stringliteral">&apos;&apos;</span>, $order);
<a name="l00080"></a>00080     }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 
<a name="l00090"></a><a class="code" href="class_todoyu_user_manager.html#aa2a4ab738a6a268c85f27971d4b6bcdf">00090</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#aa2a4ab738a6a268c85f27971d4b6bcdf">getDataArrayOfUsers</a>(array <a class="code" href="user_8php.html#a307cce3be8d8dbb46d0c949fddbf6bd0">$userIDs</a>) {
<a name="l00091"></a>00091         $userIDs    = implode(<span class="charliteral">&apos;,&apos;</span>, <a class="code" href="class_todoyu_array.html#abc24cb3709e3777abbc097959ca0498a">TodoyuArray::intval</a>($userIDs) );
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="charliteral">&apos;*&apos;</span>;
<a name="l00094"></a>00094         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = self::TABLE;
<a name="l00095"></a>00095         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; deleted = 0 AND active = 1 AND id IN (&apos;</span> . $userIDs . <span class="charliteral">&apos;)&apos;</span>;
<a name="l00096"></a>00096         $order  = <span class="stringliteral">&apos;lastname, firstname&apos;</span>;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getIndexedArray(<span class="stringliteral">&apos;id&apos;</span>, <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, <span class="stringliteral">&apos;&apos;</span>, $order);
<a name="l00099"></a>00099     }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00110"></a><a class="code" href="class_todoyu_user_manager.html#a938f0e4688d2be53dc1ad71d11a7144a">00110</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a938f0e4688d2be53dc1ad71d11a7144a">isValidLogin</a>($username, $password) {
<a name="l00111"></a>00111         <a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>  = <span class="stringliteral">&apos;id&apos;</span>;
<a name="l00112"></a>00112         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = self::TABLE;
<a name="l00113"></a>00113         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; username = &apos;</span> . <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;quote($username, <span class="keyword">true</span>) . <span class="stringliteral">&apos; AND</span>
<a name="l00114"></a>00114 <span class="stringliteral">                    password = &apos;</span> . <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;quote($password, <span class="keyword">true</span>) . <span class="stringliteral">&apos; AND</span>
<a name="l00115"></a>00115 <span class="stringliteral">                    active   = 1&apos;</span>;
<a name="l00116"></a>00116 
<a name="l00117"></a>00117         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;hasResult(<a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>);
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 
<a name="l00128"></a><a class="code" href="class_todoyu_user_manager.html#a0207c52f7721b54d30eb0e281096b2ec">00128</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a0207c52f7721b54d30eb0e281096b2ec">isUser</a>( $idUser ) {
<a name="l00129"></a>00129         $idUser = intval( $idUser );
<a name="l00130"></a>00130 
<a name="l00131"></a>00131         <a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>  = <span class="stringliteral">&apos;id&apos;</span>;
<a name="l00132"></a>00132         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = self::TABLE;
<a name="l00133"></a>00133         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos;id = &apos;</span> . $idUser;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;hasResult(<a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>);
<a name="l00136"></a>00136     }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 
<a name="l00146"></a><a class="code" href="class_todoyu_user_manager.html#adb0cfeed7e39fb4bf48466a6fabb32d8">00146</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#adb0cfeed7e39fb4bf48466a6fabb32d8">userExists</a>($username) {
<a name="l00147"></a>00147         <span class="keywordflow">return</span> <a class="code" href="class_todoyu_user_manager.html#a7d15970174c8b5d421b531d066610f1e">self::getUserIDbyUsername</a>($username) &gt; 0;
<a name="l00148"></a>00148     }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 
<a name="l00158"></a><a class="code" href="class_todoyu_user_manager.html#a7d15970174c8b5d421b531d066610f1e">00158</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a7d15970174c8b5d421b531d066610f1e">getUserIDbyUsername</a>( $username ) {
<a name="l00159"></a>00159         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="stringliteral">&apos;id&apos;</span>;
<a name="l00160"></a>00160         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = self::TABLE;
<a name="l00161"></a>00161         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos;username = &apos;</span> . <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;quote($username, <span class="keyword">true</span>);
<a name="l00162"></a>00162         $limit  = <span class="charliteral">&apos;1&apos;</span>;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164         $row    = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;doSelectRow(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, $limit);
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         <span class="keywordflow">return</span>  $row[<span class="stringliteral">&apos;id&apos;</span>];
<a name="l00167"></a>00167     }
<a name="l00168"></a>00168 
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 
<a name="l00177"></a><a class="code" href="class_todoyu_user_manager.html#ac18bad781c8bf939cd634e2b792477e9">00177</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#ac18bad781c8bf939cd634e2b792477e9">addUser</a>(array <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a> = array()) {
<a name="l00178"></a>00178         unset(<a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>[<span class="stringliteral">&apos;id&apos;</span>]);
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>[<span class="stringliteral">&apos;date_create&apos;</span>]    = <a class="code" href="core_2config_2constants_8php.html#ac3e8c0a2b7a9fc38c4f9b5c6b69231f2">NOW</a>;
<a name="l00181"></a>00181         <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>[<span class="stringliteral">&apos;id_user_create&apos;</span>] = <a class="code" href="class_todoyu_auth.html#a038ac7a8e7c043635e04f4f71ae69690">TodoyuAuth::getUserID</a>();
<a name="l00182"></a>00182 
<a name="l00183"></a>00183         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;addRecord(self::TABLE, <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>);
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185 
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00195"></a><a class="code" href="class_todoyu_user_manager.html#a2fde7613d98bf6fd80d3240388b93c66">00195</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a2fde7613d98bf6fd80d3240388b93c66">updateUser</a>($idUser, array <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>) {
<a name="l00196"></a>00196         $idUser = intval($idUser);
<a name="l00197"></a>00197 
<a name="l00198"></a>00198         unset($data[<span class="stringliteral">&apos;id&apos;</span>]);
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;updateRecord(self::TABLE, $idUser, $data);
<a name="l00201"></a>00201     }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203 
<a name="l00204"></a>00204 
<a name="l00212"></a><a class="code" href="class_todoyu_user_manager.html#a3733ccb892d5fdb91e7e3b091e95bbd8">00212</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a3733ccb892d5fdb91e7e3b091e95bbd8">saveUser</a>($idUser, array <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>) {
<a name="l00213"></a>00213         $idUser = intval($idUser);
<a name="l00214"></a>00214         <a class="code" href="ext_2dev_2controller_2form_8php.html#aec7b9eb932d6a244586d33c16797dc4a">$xmlPath</a>= <span class="stringliteral">&apos;ext/user/config/form/user.xml&apos;</span>;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         unset($data[<span class="stringliteral">&apos;id&apos;</span>]);
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 
<a name="l00219"></a>00219             <span class="comment">// Create user in database if not existing</span>
<a name="l00220"></a>00220         <span class="keywordflow">if</span>( $idUser === 0 ) {
<a name="l00221"></a>00221             $idUser = <a class="code" href="class_todoyu_user_manager.html#ac18bad781c8bf939cd634e2b792477e9">self::addUser</a>(array());
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224             <span class="comment">// Check password update</span>
<a name="l00225"></a>00225         unset($data[<span class="stringliteral">&apos;password&apos;</span>]);
<a name="l00226"></a>00226         <span class="keywordflow">if</span>( strlen($data[<span class="stringliteral">&apos;password_first&apos;</span>]) &gt; 0 ) {
<a name="l00227"></a>00227             $data[<span class="stringliteral">&apos;password&apos;</span>] = md5($data[<span class="stringliteral">&apos;password_first&apos;</span>]);
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229         unset($data[<span class="stringliteral">&apos;password_first&apos;</span>]);
<a name="l00230"></a>00230         unset($data[<span class="stringliteral">&apos;password_second&apos;</span>]);
<a name="l00231"></a>00231 
<a name="l00232"></a>00232             <span class="comment">// Call internal save function</span>
<a name="l00233"></a>00233         $data   = <a class="code" href="class_todoyu_user_manager.html#a3526f3295687fbe1d5237c79063f2778">self::saveUserForeignRecords</a>($data, $idUser);
<a name="l00234"></a>00234             <span class="comment">// Call hooked save functions</span>
<a name="l00235"></a>00235         $data   = <a class="code" href="class_todoyu_form_hook.html#a661781c57898f2b71c3c241515510324">TodoyuFormHook::callSaveData</a>(<a class="code" href="ext_2dev_2controller_2form_8php.html#aec7b9eb932d6a244586d33c16797dc4a">$xmlPath</a>, $data, $idUser);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         <a class="code" href="class_todoyu_user_manager.html#a2fde7613d98bf6fd80d3240388b93c66">self::updateUser</a>($idUser, $data);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239         <span class="keywordflow">return</span> $idUser;
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 
<a name="l00249"></a><a class="code" href="class_todoyu_user_manager.html#a4b4a96356b0326af2f1c4b3f60749faf">00249</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a4b4a96356b0326af2f1c4b3f60749faf">getUsergroupIDs</a>($idUser) {
<a name="l00250"></a>00250         $idUser = intval($idUser);
<a name="l00251"></a>00251 
<a name="l00252"></a>00252         <a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>  = <span class="stringliteral">&apos;id_group&apos;</span>;
<a name="l00253"></a>00253         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = <span class="stringliteral">&apos;ext_user_mm_user_group&apos;</span>;
<a name="l00254"></a>00254         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos;id_user = &apos;</span> . $idUser;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getColumn(<a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>);
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 
<a name="l00261"></a><a class="code" href="class_todoyu_user_manager.html#aec49228f4ae0a214459548eb0b6d6d38">00261</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#aec49228f4ae0a214459548eb0b6d6d38">getUsergroups</a>($idUser) {
<a name="l00262"></a>00262         $idUser = intval($idUser);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="stringliteral">&apos; g.*&apos;</span>;
<a name="l00265"></a>00265         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = <span class="stringliteral">&apos; ext_user_mm_user_group mm,</span>
<a name="l00266"></a>00266 <span class="stringliteral">                    ext_user_group g&apos;</span>;
<a name="l00267"></a>00267         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; id_user     = &apos;</span> . $idUser . <span class="stringliteral">&apos; AND</span>
<a name="l00268"></a>00268 <span class="stringliteral">                    mm.id_group = g.id&apos;</span>;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>);
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 
<a name="l00274"></a>00274 
<a name="l00280"></a><a class="code" href="class_todoyu_user_manager.html#ad1b95d518f63157333955c2057fb0768">00280</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#ad1b95d518f63157333955c2057fb0768">deleteUser</a>($idUser) {
<a name="l00281"></a>00281         $idUser = intval($idUser);
<a name="l00282"></a>00282 
<a name="l00283"></a>00283         <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>   = array(
<a name="l00284"></a>00284             <span class="stringliteral">&apos;deleted&apos;</span>       =&gt; 1,
<a name="l00285"></a>00285             <span class="stringliteral">&apos;date_update&apos;</span>   =&gt; <a class="code" href="core_2config_2constants_8php.html#ac3e8c0a2b7a9fc38c4f9b5c6b69231f2">NOW</a>
<a name="l00286"></a>00286         );
<a name="l00287"></a>00287 
<a name="l00288"></a>00288         <a class="code" href="class_todoyu_user_manager.html#a2fde7613d98bf6fd80d3240388b93c66">self::updateUser</a>($idUser, <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>);
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 
<a name="l00299"></a><a class="code" href="class_todoyu_user_manager.html#a068c3960920f0534b1aa2790c2b7ea1a">00299</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a068c3960920f0534b1aa2790c2b7ea1a">getGroupIDs</a>($idUser = 0) {
<a name="l00300"></a>00300         $idUser = <a class="code" href="functions_8php.html#acd1b461c014cc991f4890c41b9e9375b">userid</a>($idUser);
<a name="l00301"></a>00301 
<a name="l00302"></a>00302         <a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>  = <span class="stringliteral">&apos; g.id&apos;</span>;
<a name="l00303"></a>00303         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = <span class="stringliteral">&apos; ext_user_group g</span>
<a name="l00304"></a>00304 <span class="stringliteral">                    LEFT JOIN ext_user_mm_user_group mm</span>
<a name="l00305"></a>00305 <span class="stringliteral">                        ON mm.id_group = g.id&apos;</span>;
<a name="l00306"></a>00306         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; mm.id_user  = &apos;</span> . $idUser . <span class="stringliteral">&apos; AND</span>
<a name="l00307"></a>00307 <span class="stringliteral">                    g.deleted   = 0&apos;</span>;
<a name="l00308"></a>00308         $group  = <span class="stringliteral">&apos; g.id&apos;</span>;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getColumn(<a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, $group, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;id&apos;</span>);
<a name="l00311"></a>00311     }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 
<a name="l00321"></a><a class="code" href="class_todoyu_user_manager.html#a19b1689068b8dc90ff09752e8e111333">00321</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a19b1689068b8dc90ff09752e8e111333">getGroups</a>($idUser = 0) {
<a name="l00322"></a>00322         $idUser = <a class="code" href="functions_8php.html#acd1b461c014cc991f4890c41b9e9375b">userid</a>($idUser);
<a name="l00323"></a>00323 
<a name="l00324"></a>00324         <a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>  = <span class="stringliteral">&apos; g.*&apos;</span>;
<a name="l00325"></a>00325         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = <span class="stringliteral">&apos; ext_user_group g</span>
<a name="l00326"></a>00326 <span class="stringliteral">                    LEFT JOIN ext_user_mm_user_group mm</span>
<a name="l00327"></a>00327 <span class="stringliteral">                        ON mm.id_group = g.id&apos;</span>;
<a name="l00328"></a>00328         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; mm.id_user  = &apos;</span> . $idUser . <span class="stringliteral">&apos; AND</span>
<a name="l00329"></a>00329 <span class="stringliteral">                    g.deleted   = 0&apos;</span>;
<a name="l00330"></a>00330         $group  = <span class="stringliteral">&apos;g.id&apos;</span>;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, $group);
<a name="l00333"></a>00333     }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 
<a name="l00337"></a>00337 
<a name="l00343"></a><a class="code" href="class_todoyu_user_manager.html#a3bec68fcde3380351e0bbf7c5db8d042">00343</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a3bec68fcde3380351e0bbf7c5db8d042">getInternalUsersIDs</a>() {
<a name="l00344"></a>00344         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="stringliteral">&apos;id&apos;</span>;
<a name="l00345"></a>00345         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = self::TABLE;
<a name="l00346"></a>00346         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; type        = &apos;</span> . <a class="code" href="ext_2user_2config_2constants_8php.html#a29651e39eaefed977340da9cf03dfcda">USERTYPE_INTERNAL</a> . <span class="stringliteral">&apos; AND</span>
<a name="l00347"></a>00347 <span class="stringliteral">                    deleted     = 0 AND</span>
<a name="l00348"></a>00348 <span class="stringliteral">                    active      = 1&apos;</span>;
<a name="l00349"></a>00349         $order  = <span class="stringliteral">&apos;lastname, firstname&apos;</span>;
<a name="l00350"></a>00350 
<a name="l00351"></a>00351         $res    = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getIndexedArray(<span class="stringliteral">&apos;id&apos;</span>, <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, <span class="stringliteral">&apos;&apos;</span>, $order);
<a name="l00352"></a>00352 
<a name="l00353"></a>00353         <span class="keywordflow">return</span> array_keys($res);
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 
<a name="l00363"></a><a class="code" href="class_todoyu_user_manager.html#a544857c92ffed4e776147099a74257a6">00363</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a544857c92ffed4e776147099a74257a6">getInternalUsers</a>() {
<a name="l00364"></a>00364         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="charliteral">&apos;*&apos;</span>;
<a name="l00365"></a>00365         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = self::TABLE;
<a name="l00366"></a>00366         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; type        = &apos;</span> . <a class="code" href="ext_2user_2config_2constants_8php.html#a29651e39eaefed977340da9cf03dfcda">USERTYPE_INTERNAL</a> . <span class="stringliteral">&apos; AND</span>
<a name="l00367"></a>00367 <span class="stringliteral">                    deleted     = 0 AND</span>
<a name="l00368"></a>00368 <span class="stringliteral">                    active      = 1&apos;</span>;
<a name="l00369"></a>00369         $order  = <span class="stringliteral">&apos;lastname, firstname&apos;</span>;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getIndexedArray(<span class="stringliteral">&apos;id&apos;</span>, <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, <span class="stringliteral">&apos;&apos;</span>, $order);
<a name="l00372"></a>00372     }
<a name="l00373"></a>00373 
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 
<a name="l00381"></a><a class="code" href="class_todoyu_user_manager.html#a0e8ed155ec4fccf890b4c2a60c928a66">00381</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a0e8ed155ec4fccf890b4c2a60c928a66">getStaffUsers</a>() {
<a name="l00382"></a>00382         <span class="keywordflow">return</span> <a class="code" href="class_todoyu_user_manager.html#a544857c92ffed4e776147099a74257a6">self::getInternalUsers</a>();
<a name="l00383"></a>00383     }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00393"></a><a class="code" href="class_todoyu_user_manager.html#a342aaddc79eaa3d36ecb4969e741f37d">00393</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a342aaddc79eaa3d36ecb4969e741f37d">getInternalUsersWithEmploymentTerms</a>($getAlsoUsersWithoutJobtype = <span class="keyword">false</span>) {
<a name="l00394"></a>00394         <a class="code" href="user_8php.html#a28005d22fa7ef2dfe215ad886b497d9c">$users</a>  = <a class="code" href="class_todoyu_user_manager.html#a544857c92ffed4e776147099a74257a6">self::getInternalUsers</a>();
<a name="l00395"></a>00395         <a class="code" href="user_8php.html#a307cce3be8d8dbb46d0c949fddbf6bd0">$userIDs</a>= array_keys(<a class="code" href="user_8php.html#a28005d22fa7ef2dfe215ad886b497d9c">$users</a>);
<a name="l00396"></a>00396 
<a name="l00397"></a>00397             <span class="comment">// Get employment terms: jobtype, efficiency, daily presence</span>
<a name="l00398"></a>00398         $userEmploymentTerms    = <a class="code" href="class_todoyu_user_manager.html#a39196b3c07aaaa106af9c3309fd2dc04">self::getUserEmploymentTerms</a>(<a class="code" href="user_8php.html#a307cce3be8d8dbb46d0c949fddbf6bd0">$userIDs</a>, <span class="keyword">true</span>);
<a name="l00399"></a>00399 
<a name="l00400"></a>00400         <span class="keywordflow">foreach</span>(<a class="code" href="user_8php.html#a28005d22fa7ef2dfe215ad886b497d9c">$users</a> as $idUser =&gt; $userData) {
<a name="l00401"></a>00401             <span class="keywordflow">if</span> (array_key_exists($idUser, $userEmploymentTerms) )
<a name="l00402"></a>00402             <a class="code" href="user_8php.html#a28005d22fa7ef2dfe215ad886b497d9c">$users</a>[$idUser] = array_merge($userData, $userEmploymentTerms[$idUser]);
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405         <span class="keywordflow">return</span> <a class="code" href="user_8php.html#a28005d22fa7ef2dfe215ad886b497d9c">$users</a>;
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00415"></a><a class="code" href="class_todoyu_user_manager.html#a03f7320fe860ef56aef025cb9da97bf0">00415</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a03f7320fe860ef56aef025cb9da97bf0">getExternalUsers</a>() {
<a name="l00416"></a>00416         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="charliteral">&apos;*&apos;</span>;
<a name="l00417"></a>00417         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = self::TABLE;
<a name="l00418"></a>00418         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; type        = &apos;</span> . <a class="code" href="ext_2user_2config_2constants_8php.html#a89e955db207e0b788d98e01e26c6949b">USERTYPE_EXTERNAL</a> . <span class="stringliteral">&apos; AND</span>
<a name="l00419"></a>00419 <span class="stringliteral">                    deleted     = 0 AND</span>
<a name="l00420"></a>00420 <span class="stringliteral">                    active      = 1&apos;</span>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422         $order  = <span class="stringliteral">&apos;lastname, firstname&apos;</span>;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, <span class="stringliteral">&apos;&apos;</span>, $order);
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426 
<a name="l00427"></a>00427 
<a name="l00428"></a>00428 
<a name="l00436"></a><a class="code" href="class_todoyu_user_manager.html#a87c678c018fbe7d4646c71b637cf3614">00436</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a87c678c018fbe7d4646c71b637cf3614">getContactInfos</a>($idUser, $type = null) {
<a name="l00437"></a>00437         $idUser = intval($idUser);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="stringliteral">&apos; ci.*,</span>
<a name="l00440"></a>00440 <span class="stringliteral">                    cit.key,</span>
<a name="l00441"></a>00441 <span class="stringliteral">                    cit.title&apos;</span>;
<a name="l00442"></a>00442         $tables = <span class="stringliteral">&apos; ext_user_contactinfo ci,</span>
<a name="l00443"></a>00443 <span class="stringliteral">                    ext_user_contactinfotype cit,</span>
<a name="l00444"></a>00444 <span class="stringliteral">                    ext_user_mm_user_contactinfo mm&apos;</span>;
<a name="l00445"></a>00445         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; mm.id_user          = &apos;</span> . $idUser . <span class="stringliteral">&apos; AND</span>
<a name="l00446"></a>00446 <span class="stringliteral">                    mm.id_contactinfo   = ci.id AND</span>
<a name="l00447"></a>00447 <span class="stringliteral">                    ci.id_contactinfotype = cit.id&apos;</span>;
<a name="l00448"></a>00448         $order  = <span class="stringliteral">&apos; ci.id_contactinfotype ASC,</span>
<a name="l00449"></a>00449 <span class="stringliteral">                    ci.preferred DESC&apos;</span>;
<a name="l00450"></a>00450 
<a name="l00451"></a>00451         <span class="keywordflow">if</span>( ! is_null($type) ) {
<a name="l00452"></a>00452             <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a> .= <span class="stringliteral">&apos; AND cit.key LIKE \&apos;%&apos;</span> . <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;escape($type) . <span class="stringliteral">&apos;%\&apos;&apos;</span>;
<a name="l00453"></a>00453         }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, $tables, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, <span class="stringliteral">&apos;&apos;</span>, $order);
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 
<a name="l00467"></a><a class="code" href="class_todoyu_user_manager.html#a0b0c486e86068f68906a8a97522630b5">00467</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a0b0c486e86068f68906a8a97522630b5">searchUsers</a>($sword = <span class="stringliteral">&apos;&apos;</span>, array $searchFields = null) {
<a name="l00468"></a>00468         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="charliteral">&apos;*&apos;</span>;
<a name="l00469"></a>00469         <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = self::TABLE;
<a name="l00470"></a>00470         $order  = <span class="stringliteral">&apos;lastname&apos;</span>;
<a name="l00471"></a>00471         $swords = <a class="code" href="class_todoyu_div.html#a9a39fab5d30dc7598391cde6f1d49585">TodoyuDiv::trimExplode</a>(<span class="charliteral">&apos; &apos;</span>, $sword);
<a name="l00472"></a>00472 
<a name="l00473"></a>00473         $searchFields   = is_null($searchFields) ? array(<span class="stringliteral">&apos;username&apos;</span>, <span class="stringliteral">&apos;email&apos;</span>, <span class="stringliteral">&apos;firstname&apos;</span>, <span class="stringliteral">&apos;lastname&apos;</span>, <span class="stringliteral">&apos;shortname&apos;</span>) : $searchFields;
<a name="l00474"></a>00474 
<a name="l00475"></a>00475         <span class="keywordflow">if</span>( <span class="keyword">sizeof</span>($swords) &gt; 0 ) {
<a name="l00476"></a>00476             <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a> = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;buildLikeQuery($swords, $searchFields);
<a name="l00477"></a>00477         } <span class="keywordflow">else</span> {
<a name="l00478"></a>00478             <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a> = <span class="charliteral">&apos;1&apos;</span>;
<a name="l00479"></a>00479         }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a> .= <span class="stringliteral">&apos; AND deleted = 0&apos;</span>;
<a name="l00482"></a>00482 
<a name="l00483"></a>00483         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, <span class="stringliteral">&apos;&apos;</span>, $order);
<a name="l00484"></a>00484     }
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 
<a name="l00487"></a><a class="code" href="class_todoyu_user_manager.html#a48595d931ee91f60642463819b4a452b">00487</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a48595d931ee91f60642463819b4a452b">addUserToCustomer</a>($idUser, $idCustomer, $idWorkaddress = 0, $idJobtype = 0) {
<a name="l00488"></a>00488         <span class="keywordflow">return</span> <a class="code" href="class_todoyu_user_manager.html#a48595d931ee91f60642463819b4a452b">TodoyuCustomerManager::addUserToCustomer</a>($idCustomer, $idUser, $idWorkaddress, $idJobtype);
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 
<a name="l00493"></a>00493 
<a name="l00501"></a><a class="code" href="class_todoyu_user_manager.html#a19416963d59dc8aca3f82872d1a5fd1e">00501</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a19416963d59dc8aca3f82872d1a5fd1e">getDatabaseRelationLabel</a>(<a class="code" href="class_todoyu_form_element.html">TodoyuFormElement</a> <a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, array $record)    {
<a name="l00502"></a>00502         $idUser = intval($record[<span class="stringliteral">&apos;id&apos;</span>]);
<a name="l00503"></a>00503 
<a name="l00504"></a>00504         <span class="keywordflow">if</span>( $idUser === 0 ) {
<a name="l00505"></a>00505             $label  = <span class="stringliteral">&apos;New user&apos;</span>;
<a name="l00506"></a>00506         } <span class="keywordflow">else</span> {
<a name="l00507"></a>00507             $label  = <a class="code" href="class_todoyu_user_manager.html#a20f1940b2e0a5b53fbb418c3210871e9">self::getLabel</a>($idUser);
<a name="l00508"></a>00508         }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510         <span class="keywordflow">return</span> $label;
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 
<a name="l00514"></a>00514 
<a name="l00521"></a><a class="code" href="class_todoyu_user_manager.html#a20f1940b2e0a5b53fbb418c3210871e9">00521</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a20f1940b2e0a5b53fbb418c3210871e9">getLabel</a>($idUser)    {
<a name="l00522"></a>00522         $idUser = intval($idUser);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524         <span class="keywordflow">return</span> $idUser !== 0 ? <a class="code" href="class_todoyu_user_manager.html#a781fc7372acdae4fa54609f7893f7b7a">self::getUser</a>($idUser)-&gt;getLabel() : <span class="stringliteral">&apos;&apos;</span>;
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 
<a name="l00536"></a><a class="code" href="class_todoyu_user_manager.html#a3526f3295687fbe1d5237c79063f2778">00536</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a3526f3295687fbe1d5237c79063f2778">saveUserForeignRecords</a>(array <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>, $idUser) {
<a name="l00537"></a>00537         $idUser     = intval($idUser);
<a name="l00538"></a>00538 
<a name="l00539"></a>00539             <span class="comment">// Save customer records</span>
<a name="l00540"></a>00540         <span class="keywordflow">if</span>( ! empty($data[<span class="stringliteral">&apos;usergroup&apos;</span>]) ) {
<a name="l00541"></a>00541             $usergroupIDs   = array_unique(<a class="code" href="class_todoyu_array.html#ad2c7a0fa47bdfe76e832d0145aecbc20">TodoyuArray::getColumn</a>($data[<span class="stringliteral">&apos;usergroup&apos;</span>], <span class="stringliteral">&apos;id&apos;</span>));
<a name="l00542"></a>00542 
<a name="l00543"></a>00543             <a class="code" href="class_todoyu_user_manager.html#a874439931d8460f7db2e380371370b99">self::addUserToGroups</a>($idUser, $usergroupIDs);
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545         unset($data[<span class="stringliteral">&apos;usergroup&apos;</span>]);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547         <span class="keywordflow">return</span> $data;
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550 
<a name="l00551"></a>00551 
<a name="l00558"></a><a class="code" href="class_todoyu_user_manager.html#a52cf019212e0bbaa2c90353d6bdc4000">00558</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a52cf019212e0bbaa2c90353d6bdc4000">addUserToGroup</a>($idUser, $idUsergroup) {
<a name="l00559"></a>00559         <a class="code" href="class_todoyu_user_manager.html#a52cf019212e0bbaa2c90353d6bdc4000">TodoyuUsergroupManager::addUserToGroup</a>($idUsergroup, $idUser);
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562 
<a name="l00563"></a>00563 
<a name="l00570"></a><a class="code" href="class_todoyu_user_manager.html#ad1c8ab6caac2f3b2bac7b72a79de0891">00570</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#ad1c8ab6caac2f3b2bac7b72a79de0891">addUsersToGroup</a>(array <a class="code" href="user_8php.html#a307cce3be8d8dbb46d0c949fddbf6bd0">$userIDs</a>, $idUsergroup) {
<a name="l00571"></a>00571         <a class="code" href="class_todoyu_user_manager.html#ad1c8ab6caac2f3b2bac7b72a79de0891">TodoyuUsergroupManager::addUsersToGroup</a>($idUsergroup, $userIDs);
<a name="l00572"></a>00572     }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 
<a name="l00582"></a><a class="code" href="class_todoyu_user_manager.html#a874439931d8460f7db2e380371370b99">00582</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a874439931d8460f7db2e380371370b99">addUserToGroups</a>($idUser, array $groupIDs) {
<a name="l00583"></a>00583         <a class="code" href="class_todoyu_user_manager.html#a874439931d8460f7db2e380371370b99">TodoyuUsergroupManager::addUserToGroups</a>($idUser, $groupIDs);
<a name="l00584"></a>00584     }
<a name="l00585"></a>00585 
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 
<a name="l00593"></a><a class="code" href="class_todoyu_user_manager.html#a4e1529336b0f1c5a152d7d931aaaf4db">00593</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a4e1529336b0f1c5a152d7d931aaaf4db">removeFromCache</a>($idUser) {
<a name="l00594"></a>00594         $idUser     = intval($idUser);
<a name="l00595"></a>00595 
<a name="l00596"></a>00596         <a class="code" href="class_todoyu_cache.html#ac7002e8c3a9e9ebe38be4a316bfda43e">TodoyuCache::removeRecord</a>(<span class="stringliteral">&apos;TodoyuUser&apos;</span>, $idUser);
<a name="l00597"></a>00597         <a class="code" href="class_todoyu_cache.html#ab6211daed6f7b5048721aa9e2611a8e3">TodoyuCache::removeRecordQuery</a>(self::TABLE, $idUser);
<a name="l00598"></a>00598     }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600 
<a name="l00601"></a>00601 
<a name="l00608"></a><a class="code" href="class_todoyu_user_manager.html#ae3b82405234e672342ef152fe28a8cb0">00608</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#ae3b82405234e672342ef152fe28a8cb0">getWorkaddressIDsOfUsers</a>(array <a class="code" href="user_8php.html#a307cce3be8d8dbb46d0c949fddbf6bd0">$userIDs</a>) {
<a name="l00609"></a>00609         $userIDs    = <a class="code" href="class_todoyu_array.html#abc24cb3709e3777abbc097959ca0498a">TodoyuArray::intval</a>($userIDs, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00610"></a>00610         $addressIDs = array();
<a name="l00611"></a>00611 
<a name="l00612"></a>00612         <span class="keywordflow">if</span> (count($userIDs) &gt; 0) {
<a name="l00613"></a>00613             <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="stringliteral">&apos;id_user,id_workaddress&apos;</span>;
<a name="l00614"></a>00614             <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>  = <span class="stringliteral">&apos;ext_user_mm_customer_user&apos;</span>;
<a name="l00615"></a>00615             <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos;id_user IN (&apos;</span> . implode(<span class="charliteral">&apos;,&apos;</span>, $userIDs) . <span class="stringliteral">&apos;) &apos;</span>;
<a name="l00616"></a>00616             $res    = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>);
<a name="l00617"></a>00617 
<a name="l00618"></a>00618             <span class="keywordflow">foreach</span>($res as $entry) {
<a name="l00619"></a>00619                 $addressIDs[]   = $entry[<span class="stringliteral">&apos;id_workaddress&apos;</span>];
<a name="l00620"></a>00620             }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622             $addressIDs = array_unique($addressIDs);
<a name="l00623"></a>00623         }
<a name="l00624"></a>00624 
<a name="l00625"></a>00625         <span class="keywordflow">return</span> $addressIDs;
<a name="l00626"></a>00626     }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 
<a name="l00637"></a><a class="code" href="class_todoyu_user_manager.html#a927171bc6902a71d396e95220940bdca">00637</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a927171bc6902a71d396e95220940bdca">getUsersByBirthdayInTimespan</a>($dateStart, $dateEnd) {
<a name="l00638"></a>00638         $dateStart  = intval($dateStart);
<a name="l00639"></a>00639         $dateEnd    = intval($dateEnd);
<a name="l00640"></a>00640 
<a name="l00641"></a>00641         $dayStart   = date(<span class="charliteral">&apos;j&apos;</span>, $dateStart);
<a name="l00642"></a>00642         $monthStart = date(<span class="charliteral">&apos;n&apos;</span>, $dateStart);
<a name="l00643"></a>00643 
<a name="l00644"></a>00644         $dayEnd     = date(<span class="charliteral">&apos;j&apos;</span>, $dateEnd);
<a name="l00645"></a>00645         $monthEnd   = date(<span class="charliteral">&apos;n&apos;</span>, $dateEnd);
<a name="l00646"></a>00646 
<a name="l00647"></a>00647         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="stringliteral">&apos; id, email, active, firstname, lastname, shortname, gender, title,</span>
<a name="l00648"></a>00648 <span class="stringliteral">                    UNIX_TIMESTAMP( birthday ) as tstamp_birthday,</span>
<a name="l00649"></a>00649 <span class="stringliteral">                    birthday, SUBSTRING(birthday, 6) as birthday_md, SUBSTRING(birthday, 1, 4) as year,</span>
<a name="l00650"></a>00650 <span class="stringliteral">                    ((UNIX_TIMESTAMP( NOW() ) - UNIX_TIMESTAMP( birthday ) ) / 31536000 ) as age</span>
<a name="l00651"></a>00651 <span class="stringliteral">                    &apos;</span>;
<a name="l00652"></a>00652 
<a name="l00653"></a>00653         $tables = <span class="stringliteral">&apos;ext_user_user&apos;</span>;
<a name="l00654"></a>00654 
<a name="l00655"></a>00655         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  =  <span class="stringliteral">&apos; deleted    = 0 &apos;</span>;
<a name="l00656"></a>00656         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  .= <span class="stringliteral">&apos; AND ( MONTH(birthday) &gt;= &apos;</span> . $monthStart . <span class="stringliteral">&apos; AND MONTH(birthday) &lt;= &apos;</span>  . $monthEnd . <span class="stringliteral">&apos; )&apos;</span>;
<a name="l00657"></a>00657 
<a name="l00658"></a>00658         $order  = <span class="stringliteral">&apos;birthday_md&apos;</span>;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660         $res    = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getIndexedArray(<span class="stringliteral">&apos;id&apos;</span>, <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, $tables, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, <span class="stringliteral">&apos;&apos;</span>, $order);
<a name="l00661"></a>00661 
<a name="l00662"></a>00662         $birthdays = array();
<a name="l00663"></a>00663             <span class="comment">// Remove birthdays outside the exact given days range</span>
<a name="l00664"></a>00664         <span class="keywordflow">foreach</span>($res as $id =&gt; $birthday) {
<a name="l00665"></a>00665             list($month, $day)  = explode(<span class="charliteral">&apos;-&apos;</span>, $birthday[<span class="stringliteral">&apos;birthday_md&apos;</span>]);
<a name="l00666"></a>00666             <span class="keywordflow">if</span> (    ( ($day &gt;= $dayStart &amp;&amp; $month == $monthStart) || $month &gt; $monthStart)
<a name="l00667"></a>00667                 &amp;&amp;  ( ($day &lt;= $dayEnd &amp;&amp; $month &lt;= $monthEnd) || $month == $monthStart )
<a name="l00668"></a>00668             ) {
<a name="l00669"></a>00669                 $birthdays[$id] = $birthday;
<a name="l00670"></a>00670             }
<a name="l00671"></a>00671         }
<a name="l00672"></a>00672 
<a name="l00673"></a>00673         <span class="keywordflow">return</span> $birthdays;
<a name="l00674"></a>00674     }
<a name="l00675"></a>00675 
<a name="l00676"></a>00676 
<a name="l00677"></a>00677 
<a name="l00685"></a><a class="code" href="class_todoyu_user_manager.html#a380301f5ca020358154b9adb52ac7f81">00685</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a380301f5ca020358154b9adb52ac7f81">listUserIDsToJobtypes</a>(array $jobTypes, array $prefs) {
<a name="l00686"></a>00686         <span class="keywordflow">foreach</span>($jobTypes as $idJobtype =&gt; $jobtypeData) {
<a name="l00687"></a>00687             $jobTypes[$idJobtype][<span class="stringliteral">&apos;user_ids&apos;</span>] = implode(<span class="charliteral">&apos;,&apos;</span>, $jobTypes[$idJobtype][<span class="stringliteral">&apos;user_ids&apos;</span>] );
<a name="l00688"></a>00688 
<a name="l00689"></a>00689                 <span class="comment">// Set job types selected as stored in user prefs</span>
<a name="l00690"></a>00690             <span class="keywordflow">if</span> (is_array($prefs[<span class="stringliteral">&apos;selectedJobtypeIDs&apos;</span>]) &amp;&amp; in_array($idJobtype, $prefs[<span class="stringliteral">&apos;selectedJobtypeIDs&apos;</span>]) ) {
<a name="l00691"></a>00691                 $jobTypes[ $idJobtype ][<span class="stringliteral">&apos;selected&apos;</span>] = 1;
<a name="l00692"></a>00692             } <span class="keywordflow">else</span> {
<a name="l00693"></a>00693                 $jobTypes[ $idJobtype ][<span class="stringliteral">&apos;selected&apos;</span>] = 0;
<a name="l00694"></a>00694             }
<a name="l00695"></a>00695         }
<a name="l00696"></a>00696 
<a name="l00697"></a>00697         <span class="keywordflow">return</span> $jobTypes;
<a name="l00698"></a>00698     }
<a name="l00699"></a>00699 
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 
<a name="l00709"></a><a class="code" href="class_todoyu_user_manager.html#a39196b3c07aaaa106af9c3309fd2dc04">00709</a>     <span class="keyword">public</span> function <a class="code" href="class_todoyu_user_manager.html#a39196b3c07aaaa106af9c3309fd2dc04">getUserEmploymentTerms</a>(array <a class="code" href="user_8php.html#a307cce3be8d8dbb46d0c949fddbf6bd0">$userIDs</a>, $getJobLabels = <span class="keyword">false</span>) {
<a name="l00710"></a>00710         $userIDs    = <a class="code" href="class_todoyu_array.html#abc24cb3709e3777abbc097959ca0498a">TodoyuArray::intval</a>($userIDs, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00711"></a>00711 
<a name="l00712"></a>00712         $employment = array();
<a name="l00713"></a>00713         <span class="keywordflow">if</span> (count($userIDs) &gt; 0) {
<a name="l00714"></a>00714             $indexField = <span class="stringliteral">&apos;id_user&apos;</span>;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716             <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>      = <span class="stringliteral">&apos;c.id_user, c.id_workaddress, c.id_jobtype&apos;</span>;
<a name="l00717"></a>00717             <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>     .= <span class="stringliteral">&apos;, c.ext_resources_efficiency, c.ext_resources_wl_mon_am, c.ext_resources_wl_mon_pm, c.ext_resources_wl_tue_am, c.ext_resources_wl_tue_pm, c.ext_resources_wl_wed_am, c.ext_resources_wl_wed_pm, c.ext_resources_wl_thu_am, c.ext_resources_wl_thu_pm, c.ext_resources_wl_fri_am, c.ext_resources_wl_fri_pm, c.ext_resources_wl_sat_am, c.ext_resources_wl_sat_pm, c.ext_resources_wl_sun_am, c.ext_resources_wl_sun_pm&apos;</span>;
<a name="l00718"></a>00718             <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>     .= <span class="stringliteral">&apos;, c.ext_resources_wl_mon_am + c.ext_resources_wl_mon_pm + c.ext_resources_wl_tue_am + c.ext_resources_wl_tue_pm + c.ext_resources_wl_wed_am + c.ext_resources_wl_wed_pm + c.ext_resources_wl_thu_am + c.ext_resources_wl_thu_pm + c.ext_resources_wl_fri_am + c.ext_resources_wl_fri_pm + c.ext_resources_wl_sat_am + c.ext_resources_wl_sat_pm + c.ext_resources_wl_sun_am + c.ext_resources_wl_sun_pm as generalPresenceTotal&apos;</span>;
<a name="l00719"></a>00719             <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>     .= ($getJobLabels ? <span class="stringliteral">&apos;, j.title as jobtitle&apos;</span> : <span class="stringliteral">&apos;&apos;</span>);
<a name="l00720"></a>00720 
<a name="l00721"></a>00721             $tables     = <span class="stringliteral">&apos;ext_user_mm_customer_user c&apos;</span> . ($getJobLabels ? <span class="stringliteral">&apos;, ext_user_jobtype j&apos;</span> : <span class="stringliteral">&apos;&apos;</span>);
<a name="l00722"></a>00722             <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>      = <span class="stringliteral">&apos;c.id_user IN (&apos;</span> . implode(<span class="charliteral">&apos;,&apos;</span>, $userIDs) . <span class="stringliteral">&apos;) &apos;</span>;
<a name="l00723"></a>00723 
<a name="l00724"></a>00724             $employment = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getIndexedArray($indexField, <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, $tables, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>);
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726 
<a name="l00727"></a>00727         <span class="keywordflow">return</span> $employment;
<a name="l00728"></a>00728     }
<a name="l00729"></a>00729 
<a name="l00730"></a>00730 
<a name="l00731"></a>00731 
<a name="l00738"></a><a class="code" href="class_todoyu_user_manager.html#a18dad2be8784f40b7b107f7742dce59e">00738</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a18dad2be8784f40b7b107f7742dce59e">getSelectedUsersColor</a>(array <a class="code" href="user_8php.html#a307cce3be8d8dbb46d0c949fddbf6bd0">$userIDs</a>) {
<a name="l00739"></a>00739         $userIDs    = <a class="code" href="class_todoyu_array.html#abc24cb3709e3777abbc097959ca0498a">TodoyuArray::intval</a>($userIDs, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00740"></a>00740         $cacheKey   = <span class="stringliteral">&apos;usercolors:&apos;</span> . md5(serialize($userIDs));
<a name="l00741"></a>00741 
<a name="l00742"></a>00742         <span class="keywordflow">if</span>( ! <a class="code" href="class_todoyu_cache.html#a5bf9f381364c1c275fc28fe9cc4a40f3">TodoyuCache::isIn</a>($cacheKey) ) {
<a name="l00743"></a>00743             $colors = array();
<a name="l00744"></a>00744             $internalUserIDs = <a class="code" href="class_todoyu_user_manager.html#a3bec68fcde3380351e0bbf7c5db8d042">TodoyuUserManager::getInternalUsersIDs</a>();
<a name="l00745"></a>00745 
<a name="l00746"></a>00746                 <span class="comment">// Enumerate users by system specific color to resp. list position</span>
<a name="l00747"></a>00747             <span class="keywordflow">foreach</span>($userIDs as $idUser) {
<a name="l00748"></a>00748                 $colors[$idUser]    = <a class="code" href="class_todoyu_colors.html#ace24d68198807ffdc8e4ab7784dd8a54">TodoyuColors::getColorArray</a>($internalUserIDs[$idUser]);
<a name="l00749"></a>00749             }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751             <a class="code" href="class_todoyu_cache.html#aaa83698e63dd0c924b95b2f9d30b961b">TodoyuCache::set</a>($cacheKey, $colors);
<a name="l00752"></a>00752         }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754         <span class="keywordflow">return</span> <a class="code" href="class_todoyu_cache.html#a15e2679f2a8f6fa4d60757f4d65413ac">TodoyuCache::get</a>($cacheKey);
<a name="l00755"></a>00755     }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 
<a name="l00758"></a>00758 
<a name="l00765"></a><a class="code" href="class_todoyu_user_manager.html#a6cf8ea18729913bc4b39c5d854cdf850">00765</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a6cf8ea18729913bc4b39c5d854cdf850">getUserCompanyRecords</a>($idUser) {
<a name="l00766"></a>00766         $idUser = intval($idUser);
<a name="l00767"></a>00767 
<a name="l00768"></a>00768         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="stringliteral">&apos; mm.*,</span>
<a name="l00769"></a>00769 <span class="stringliteral">                    c.*&apos;</span>;
<a name="l00770"></a>00770         $tables = <span class="stringliteral">&apos; ext_user_customer c,</span>
<a name="l00771"></a>00771 <span class="stringliteral">                    ext_user_mm_customer_user mm&apos;</span>;
<a name="l00772"></a>00772         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; mm.id_customer  = c.id AND</span>
<a name="l00773"></a>00773 <span class="stringliteral">                    mm.id_user      = &apos;</span> . $idUser;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, $tables, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>);
<a name="l00776"></a>00776     }
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 
<a name="l00786"></a><a class="code" href="class_todoyu_user_manager.html#a6a662c479cee30142a9ada60a9af1bb8">00786</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a6a662c479cee30142a9ada60a9af1bb8">getUserContactinfoRecords</a>($idUser) {
<a name="l00787"></a>00787         $idUser = intval($idUser);
<a name="l00788"></a>00788 
<a name="l00789"></a>00789         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="stringliteral">&apos; c.*&apos;</span>;
<a name="l00790"></a>00790         $tables = <span class="stringliteral">&apos; ext_user_contactinfo c,</span>
<a name="l00791"></a>00791 <span class="stringliteral">                    ext_user_mm_user_contactinfo mm&apos;</span>;
<a name="l00792"></a>00792         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; mm.id_contactinfo   = c.id AND</span>
<a name="l00793"></a>00793 <span class="stringliteral">                    mm.id_user          = &apos;</span> . $idUser;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, $tables, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>);
<a name="l00796"></a>00796     }
<a name="l00797"></a>00797 
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 
<a name="l00806"></a><a class="code" href="class_todoyu_user_manager.html#aa6c2987540f33273518b7a3ef5537a36">00806</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#aa6c2987540f33273518b7a3ef5537a36">getUserAddressRecords</a>($idUser) {
<a name="l00807"></a>00807         $idUser = intval($idUser);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <span class="stringliteral">&apos; a.*&apos;</span>;
<a name="l00810"></a>00810         $tables = <span class="stringliteral">&apos; ext_user_address a,</span>
<a name="l00811"></a>00811 <span class="stringliteral">                    ext_user_mm_user_address mm&apos;</span>;
<a name="l00812"></a>00812         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <span class="stringliteral">&apos; mm.id_address   = a.id AND</span>
<a name="l00813"></a>00813 <span class="stringliteral">                    mm.id_user      = &apos;</span> . $idUser;
<a name="l00814"></a>00814 
<a name="l00815"></a>00815         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, $tables, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>);
<a name="l00816"></a>00816     }
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 
<a name="l00819"></a>00819 
<a name="l00825"></a><a class="code" href="class_todoyu_user_manager.html#a427eba23793faeb17fff8a719f0cea02">00825</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_user_manager.html#a427eba23793faeb17fff8a719f0cea02">getUserTypes</a>() {
<a name="l00826"></a>00826         <span class="keywordflow">return</span> <a class="code" href="filterwidgetconf_8php.html#a5256d5171498a1b9833f7a1fc459aa2f">$GLOBALS</a>[<span class="stringliteral">&apos;CONFIG&apos;</span>][<span class="stringliteral">&apos;EXT&apos;</span>][<span class="stringliteral">&apos;user&apos;</span>][<span class="stringliteral">&apos;usertype&apos;</span>];
<a name="l00827"></a>00827     }
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 }
<a name="l00830"></a>00830 ?&gt;
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Erzeugt am Tue Dec 1 18:32:37 2009 f√ºr Todoyu von&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
