<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Todoyu: C:/Programme/xampp/htdocs/todoyu2/core/TodoyuDiv.class.php Quellcode</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Erzeugt von Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Hauptseite</span></a></li>
      <li><a href="pages.html"><span>Zus√§tzliche&nbsp;Informationen</span></a></li>
      <li><a href="namespaces.html"><span>Namensbereiche</span></a></li>
      <li><a href="annotated.html"><span>Datenstrukturen</span></a></li>
      <li class="current"><a href="files.html"><span>Dateien</span></a></li>
      <li><a href="examples.html"><span>Beispiele</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>Auflistung&nbsp;der&nbsp;Dateien</span></a></li>
      <li><a href="globals.html"><span>Datei-Elemente</span></a></li>
    </ul>
  </div>
<h1>C:/Programme/xampp/htdocs/todoyu2/core/TodoyuDiv.class.php</h1><a href="_todoyu_div_8class_8php.html">gehe zur Dokumentation dieser Datei</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/***************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">*  Copyright notice</span>
<a name="l00004"></a>00004 <span class="comment">*</span>
<a name="l00005"></a>00005 <span class="comment">*  (c) 2009 snowflake productions gmbh</span>
<a name="l00006"></a>00006 <span class="comment">*  All rights reserved</span>
<a name="l00007"></a>00007 <span class="comment">*</span>
<a name="l00008"></a>00008 <span class="comment">*  This script is part of the todoyu project.</span>
<a name="l00009"></a>00009 <span class="comment">*  The todoyu project is free software; you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment">*  it under the terms of the GNU General Public License, version 2,</span>
<a name="l00011"></a>00011 <span class="comment">*  (http://www.gnu.org/licenses/old-licenses/gpl-2.0.html) as published by</span>
<a name="l00012"></a>00012 <span class="comment">*  the Free Software Foundation;</span>
<a name="l00013"></a>00013 <span class="comment">*</span>
<a name="l00014"></a>00014 <span class="comment">*  This script is distributed in the hope that it will be useful,</span>
<a name="l00015"></a>00015 <span class="comment">*  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00016"></a>00016 <span class="comment">*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<a name="l00017"></a>00017 <span class="comment">*  GNU General Public License for more details.</span>
<a name="l00018"></a>00018 <span class="comment">*</span>
<a name="l00019"></a>00019 <span class="comment">*  This copyright notice MUST APPEAR in all copies of the script!</span>
<a name="l00020"></a>00020 <span class="comment">***************************************************************/</span>
<a name="l00021"></a>00021 
<a name="l00029"></a><a class="code" href="class_todoyu_div.html">00029</a> <span class="keyword">class </span><a class="code" href="class_todoyu_div.html">TodoyuDiv</a> {
<a name="l00030"></a>00030 
<a name="l00036"></a>00036     <span class="keyword">private</span> <span class="keyword">static</span> $mcrypt = null;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 
<a name="l00050"></a><a class="code" href="class_todoyu_div.html#a7dd547c8422f80618eab4a46391d7349">00050</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a7dd547c8422f80618eab4a46391d7349">generatePassword</a>($length = 8, $useLowerCase = <span class="keyword">false</span>, $useNumbers = <span class="keyword">true</span>, $useSpecialChars = <span class="keyword">false</span>, $useDoubleChars = <span class="keyword">true</span>) {
<a name="l00051"></a>00051         $length     = intval($length);
<a name="l00052"></a>00052         $characters = array_merge(range(<span class="charliteral">&apos;a&apos;</span>, <span class="charliteral">&apos;z&apos;</span>), range(<span class="charliteral">&apos;A&apos;</span>, <span class="charliteral">&apos;Z&apos;</span>));
<a name="l00053"></a>00053 
<a name="l00054"></a>00054         <span class="keywordflow">if</span>( $useNumbers ) {
<a name="l00055"></a>00055             $characters = array_merge($characters, range(<span class="charliteral">&apos;0&apos;</span>, <span class="charliteral">&apos;9&apos;</span>));
<a name="l00056"></a>00056         }
<a name="l00057"></a>00057         <span class="keywordflow">if</span>( $useSpecialChars ) {
<a name="l00058"></a>00058             $characters = array_merge($characters, array(<span class="charliteral">&apos;#&apos;</span>,<span class="charliteral">&apos;&amp;&apos;</span>,<span class="charliteral">&apos;@&apos;</span>,<span class="charliteral">&apos;$&apos;</span>,<span class="charliteral">&apos;_&apos;</span>,<span class="charliteral">&apos;%&apos;</span>,<span class="charliteral">&apos;?&apos;</span>,<span class="charliteral">&apos;+&apos;</span>,<span class="charliteral">&apos;-&apos;</span>));
<a name="l00059"></a>00059         }
<a name="l00060"></a>00060         <span class="keywordflow">if</span>( $useDoubleChars ) {
<a name="l00061"></a>00061             shuffle($characters);
<a name="l00062"></a>00062             $characters = array_merge($characters, $characters);
<a name="l00063"></a>00063         }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065         <span class="comment">// Shuffle array</span>
<a name="l00066"></a>00066         shuffle($characters);
<a name="l00067"></a>00067         $password = substr(implode(<span class="stringliteral">&apos;&apos;</span>, $characters), 0, $length);
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         <span class="keywordflow">if</span>( $useLowerCase ) {
<a name="l00070"></a>00070             $password = strtolower($password);
<a name="l00071"></a>00071         }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         <span class="keywordflow">return</span> $password;
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 
<a name="l00086"></a><a class="code" href="class_todoyu_div.html#a89ff8cf2a84ea0edcdba337c3aeb4287">00086</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a89ff8cf2a84ea0edcdba337c3aeb4287">sendAsJson</a>($phpData, $stopScript = <span class="keyword">true</span>) {
<a name="l00087"></a>00087         header(<span class="stringliteral">&quot;Content-Type: application/json, charset=utf-8&quot;</span>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         echo json_encode($phpData);
<a name="l00090"></a>00090 
<a name="l00091"></a>00091         <span class="keywordflow">if</span>( $stopScript ) {
<a name="l00092"></a>00092             exit();
<a name="l00093"></a>00093         }
<a name="l00094"></a>00094     }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 
<a name="l00103"></a><a class="code" href="class_todoyu_div.html#a508daa3f381ee4cd10654bfab920f14b">00103</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a508daa3f381ee4cd10654bfab920f14b">isUTF8</a>($stringToCheck) {
<a name="l00104"></a>00104         <span class="keywordflow">return</span> mb_detect_encoding($stringToCheck, <span class="stringliteral">&apos;UTF-8, ISO-8859-1&apos;</span>) === <span class="stringliteral">&apos;UTF-8&apos;</span>;
<a name="l00105"></a>00105     }
<a name="l00106"></a>00106 
<a name="l00107"></a>00107 
<a name="l00108"></a>00108 
<a name="l00115"></a><a class="code" href="class_todoyu_div.html#a1bc261518650a454218cc2ef4a054dc1">00115</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a1bc261518650a454218cc2ef4a054dc1">convertToUTF8</a>($stringToConvert) {
<a name="l00116"></a>00116         <span class="keywordflow">return</span> <a class="code" href="class_todoyu_div.html#a508daa3f381ee4cd10654bfab920f14b">self::isUTF8</a>($stringToConvert) ? $stringToConvert : utf8_encode($stringToConvert);
<a name="l00117"></a>00117     }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 
<a name="l00127"></a><a class="code" href="class_todoyu_div.html#ac076535b805d3d1deeda6d08cbbd9914">00127</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#ac076535b805d3d1deeda6d08cbbd9914">convertToUTF8Array</a>(array $arrayToConvert) {
<a name="l00128"></a>00128         $convertedArray = array();
<a name="l00129"></a>00129 
<a name="l00130"></a>00130         <span class="keywordflow">foreach</span>( $arrayToConvert as $key =&gt; $value ) {
<a name="l00131"></a>00131             $convertedArray[$key] = <a class="code" href="class_todoyu_div.html#a1bc261518650a454218cc2ef4a054dc1">self::convertToUTF8</a>($value);
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134         <span class="keywordflow">return</span> $convertedArray;
<a name="l00135"></a>00135     }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 
<a name="l00148"></a><a class="code" href="class_todoyu_div.html#a54662513802f01f2e5cfd7ee936f0bab">00148</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a54662513802f01f2e5cfd7ee936f0bab">intInRange</a>($integer, $min = 0, $max = 2000000000)    {
<a name="l00149"></a>00149         $integer = intval($integer);
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         <span class="keywordflow">if</span>( $integer &lt; $min ) {
<a name="l00152"></a>00152             $integer = $min;
<a name="l00153"></a>00153         }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155         <span class="keywordflow">if</span>( $integer &gt; $max ) {
<a name="l00156"></a>00156             $integer = $max;
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         <span class="keywordflow">return</span> $integer;
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 
<a name="l00170"></a><a class="code" href="class_todoyu_div.html#a7cd4f78793774e3ae52259fc28885bbd">00170</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a7cd4f78793774e3ae52259fc28885bbd">intPositive</a>($value) {
<a name="l00171"></a>00171         $integer = intval($value);
<a name="l00172"></a>00172 
<a name="l00173"></a>00173         <span class="keywordflow">if</span>( $integer &lt; 0 ) {
<a name="l00174"></a>00174             $integer = 0;
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177         <span class="keywordflow">return</span> $integer;
<a name="l00178"></a>00178     }
<a name="l00179"></a>00179 
<a name="l00187"></a><a class="code" href="class_todoyu_div.html#ae267706746d6bf25685a043fa4ca8489">00187</a>     function <a class="code" href="class_todoyu_div.html#ae267706746d6bf25685a043fa4ca8489">percent</a>($percent, $value)  {
<a name="l00188"></a>00188         <span class="keywordflow">return</span> $percent * ($value / 100.0);
<a name="l00189"></a>00189     }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00199"></a><a class="code" href="class_todoyu_div.html#a6eba0d7410859145a018f16856b2eb24">00199</a>     function <a class="code" href="class_todoyu_div.html#a6eba0d7410859145a018f16856b2eb24">fraction</a>($fraction = 75, $total = 300) {
<a name="l00200"></a>00200         <span class="keywordflow">if</span> ($total &gt; 0) {
<a name="l00201"></a>00201             $rc = intval (($fraction/ $total) * 100);
<a name="l00202"></a>00202         } <span class="keywordflow">else</span> {
<a name="l00203"></a>00203             <a class="code" href="class_todoyu_debug.html#a7a5d0dd4f323a284503b7c60d38997de">TodoyuDebug::printHtml</a>(<span class="stringliteral">&apos;error in fraction(...) - division by 0!&apos;</span>);
<a name="l00204"></a>00204         }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         <span class="keywordflow">return</span> $rc;
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 
<a name="l00217"></a><a class="code" href="class_todoyu_div.html#ad0b28edbc65c4cd36d2db8221a88266c">00217</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#ad0b28edbc65c4cd36d2db8221a88266c">validEmail</a>($email)   {
<a name="l00218"></a>00218         $email = trim ($email);
<a name="l00219"></a>00219         <span class="keywordflow">if</span>( strstr($email,<span class="charliteral">&apos; &apos;</span>) ) {
<a name="l00220"></a>00220             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223         <span class="keywordflow">return</span> ereg(<span class="stringliteral">&apos;^[A-Za-z0-9\._-]+[@][A-Za-z0-9\._-]+[\.].[A-Za-z0-9]+$&apos;</span>, $email) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00224"></a>00224     }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 
<a name="l00238"></a><a class="code" href="class_todoyu_div.html#ab32ced65de1bdf013bc8809a9887d50b">00238</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#ab32ced65de1bdf013bc8809a9887d50b">intExplode</a>($delimiter, $string, $onlyPositive = <span class="keyword">false</span>, $removeZeros = <span class="keyword">false</span>, $parseConstants = <span class="keyword">false</span>) {
<a name="l00239"></a>00239         $parts  = explode($delimiter, $string);
<a name="l00240"></a>00240 
<a name="l00241"></a>00241         <span class="keywordflow">return</span> <a class="code" href="class_todoyu_array.html#abc24cb3709e3777abbc097959ca0498a">TodoyuArray::intval</a>($parts, $onlyPositive, $removeZeros, $parseConstants);
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00254"></a><a class="code" href="class_todoyu_div.html#a9a39fab5d30dc7598391cde6f1d49585">00254</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a9a39fab5d30dc7598391cde6f1d49585">trimExplode</a>($delimiter, $string, $removeEmptyValues = <span class="keyword">false</span>) {
<a name="l00255"></a>00255         $parts  = explode($delimiter, $string);
<a name="l00256"></a>00256         $array  = array();
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         <span class="keywordflow">foreach</span>($parts as $value) {
<a name="l00259"></a>00259             $value = trim($value);
<a name="l00260"></a>00260             <span class="keywordflow">if</span>( $value !== <span class="stringliteral">&apos;&apos;</span> || $removeEmptyValues === <span class="keyword">false</span> ) {
<a name="l00261"></a>00261                 $array[] = $value;
<a name="l00262"></a>00262             }
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         <span class="keywordflow">return</span> $array;
<a name="l00266"></a>00266     }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 
<a name="l00269"></a>00269 
<a name="l00276"></a><a class="code" href="class_todoyu_div.html#a8606df5c29cedc23b02514142492366a">00276</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a8606df5c29cedc23b02514142492366a">removeSitePath</a>(<a class="code" href="erni_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>) {
<a name="l00277"></a>00277         <span class="keywordflow">return</span> <a class="code" href="javascript_8js.html#a653ea8da4d112c6bce1135d086cb38c9">str_replace</a>(<a class="code" href="core_2config_2constants_8php.html#a98e6ec34047e8d89ccc3884beede053a">PATH</a>, <span class="stringliteral">&apos;&apos;</span>, <a class="code" href="erni_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>);
<a name="l00278"></a>00278     }
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 
<a name="l00281"></a>00281 
<a name="l00293"></a><a class="code" href="class_todoyu_div.html#af524493ec23ec3fb0dfc4fcb025d68cc">00293</a>     function <a class="code" href="class_todoyu_div.html#af524493ec23ec3fb0dfc4fcb025d68cc">getAutocompleteValues</a>($searchWords, <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, $searchInFields, $numKeywords = 10) {
<a name="l00294"></a>00294         <span class="comment">// Get database result</span>
<a name="l00295"></a>00295         $elements   = $this-&gt;<a class="code" href="class_todoyu_div.html#a9c9522dfcd7cac4360814eda2ff8ad10">searchTable</a>(<a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, $searchInFields, $searchWords, $searchInFields, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, 0, $numKeywords*5);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         <span class="comment">// Make a big string</span>
<a name="l00298"></a>00298         $allWords   = <span class="stringliteral">&apos;&apos;</span>;
<a name="l00299"></a>00299         <span class="keywordflow">foreach</span>($elements as $element) {
<a name="l00300"></a>00300             $allWords .= implode(<span class="charliteral">&apos; &apos;</span>, $element);
<a name="l00301"></a>00301         }
<a name="l00302"></a>00302 
<a name="l00303"></a>00303         <span class="comment">// Replace all whitespaces by single space</span>
<a name="l00304"></a>00304         $allWords = strtolower(preg_replace(<span class="stringliteral">&apos;|\W|&apos;</span>, <span class="charliteral">&apos; &apos;</span>, $allWords));
<a name="l00305"></a>00305 
<a name="l00306"></a>00306         <span class="comment">// Search matching words</span>
<a name="l00307"></a>00307         $pattern    = <span class="stringliteral">&apos;/([^ ]*&apos;</span> . $searchWords . <span class="stringliteral">&apos;[^ ]*)/i&apos;</span>;
<a name="l00308"></a>00308         preg_match_all($pattern, $allWords, $matches);
<a name="l00309"></a>00309 
<a name="l00310"></a>00310         <span class="comment">// Clean up</span>
<a name="l00311"></a>00311         $keywords   = array_map(<span class="stringliteral">&apos;trim&apos;</span>, $matches[0]);
<a name="l00312"></a>00312         $keywords   = array_unique($keywords);
<a name="l00313"></a>00313 
<a name="l00314"></a>00314         <span class="keywordflow">return</span> array_slice($keywords, 0, $numKeywords);
<a name="l00315"></a>00315     }
<a name="l00316"></a>00316 
<a name="l00317"></a>00317 
<a name="l00318"></a>00318 
<a name="l00335"></a><a class="code" href="class_todoyu_div.html#a9c9522dfcd7cac4360814eda2ff8ad10">00335</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a9c9522dfcd7cac4360814eda2ff8ad10">searchTable</a>(<a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>, array $searchInFields, array $searchWords, $fieldsInResult = <span class="charliteral">&apos;*&apos;</span>, array $extraTables = array(), $extraWhere = <span class="stringliteral">&apos;&apos;</span>, $groupBy = <span class="stringliteral">&apos;&apos;</span>, $orderBy = <span class="stringliteral">&apos;&apos;</span>, $limitOffset = 0, $limitRows = 200) {
<a name="l00336"></a>00336 
<a name="l00337"></a>00337         <span class="comment">// Compile selected fields</span>
<a name="l00338"></a>00338         <span class="comment">// Prepend table name, if all fields are requested</span>
<a name="l00339"></a>00339         <span class="keywordflow">if</span>( $fieldsInResult === <span class="charliteral">&apos;*&apos;</span> ) {
<a name="l00340"></a>00340             $fieldsInResult = <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> . <span class="stringliteral">&apos;.*&apos;</span>;
<a name="l00341"></a>00341         } <span class="keywordflow">else</span> {
<a name="l00342"></a>00342             <span class="comment">// Split fields and prepend table if not done yet</span>
<a name="l00343"></a>00343             <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = <a class="code" href="class_todoyu_div.html#a9a39fab5d30dc7598391cde6f1d49585">TodoyuDiv::trimExplode</a>(<span class="charliteral">&apos;,&apos;</span>, $fieldsInResult, <span class="keyword">true</span>);
<a name="l00344"></a>00344             <span class="keywordflow">foreach</span>(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> as $key =&gt; <a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>) {
<a name="l00345"></a>00345                 <span class="keywordflow">if</span>( strstr(<a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>, <span class="charliteral">&apos;.&apos;</span>) === <span class="keyword">false</span> ) {
<a name="l00346"></a>00346                     <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>[$key] = <a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a> . <span class="charliteral">&apos;.&apos;</span> . <a class="code" href="acknowledged__tasks_8php.html#a83e4d6721f3491a4fd780dbd3ce1a3c0">$field</a>;
<a name="l00347"></a>00347                 }
<a name="l00348"></a>00348             }
<a name="l00349"></a>00349             $fieldsInResult = implode(<span class="stringliteral">&apos;, &apos;</span>, <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>);
<a name="l00350"></a>00350         }
<a name="l00351"></a>00351 
<a name="l00352"></a>00352         <a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a> = $fieldsInResult;
<a name="l00353"></a>00353         $tables = implode(<span class="stringliteral">&apos;, &apos;</span>, array_unique(array_merge($extraTables, array(<a class="code" href="acknowledged__after_8php.html#ae8876a14058f368335baccf35af4a22b">$table</a>))));
<a name="l00354"></a>00354         <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>  = <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;buildLikeQuery($searchWords, $searchInFields);
<a name="l00355"></a>00355         $limit  = <a class="code" href="class_todoyu_div.html#a7cd4f78793774e3ae52259fc28885bbd">TodoyuDiv::intPositive</a>($limitOffset) . <span class="charliteral">&apos;,&apos;</span> . <a class="code" href="class_todoyu_div.html#a7cd4f78793774e3ae52259fc28885bbd">TodoyuDiv::intPositive</a>($limitRows);
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 
<a name="l00358"></a>00358         <span class="keywordflow">if</span>( $extraWhere != <span class="stringliteral">&apos;&apos;</span> ) {
<a name="l00359"></a>00359             <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a> .= <span class="charliteral">&apos; &apos;</span> . $extraWhere;
<a name="l00360"></a>00360         }
<a name="l00361"></a>00361 
<a name="l00362"></a>00362         <span class="keywordflow">return</span> <a class="code" href="class_todoyu.html#abf2dfcff06cad1e6c249ddc4df4d0866">Todoyu::db</a>()-&gt;getArray(<a class="code" href="daily__workload_8php.html#ab2303c817e3b402b77b7f99627b9c319">$fields</a>, $tables, <a class="code" href="acknowledged__after_8php.html#aa2080b85972946a82a6ec215a34f7d69">$where</a>, $groupBy, $orderBy, $limit);
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364 
<a name="l00365"></a>00365 
<a name="l00366"></a>00366 
<a name="l00375"></a><a class="code" href="class_todoyu_div.html#a71fad5548fe188ea7853db0d5337e43b">00375</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a71fad5548fe188ea7853db0d5337e43b">getLabel</a>($label, $locale = null) {
<a name="l00376"></a>00376         <span class="keywordflow">if</span>( ! is_string($label) ) {
<a name="l00377"></a>00377             <span class="keywordflow">return</span> <span class="stringliteral">&apos;&apos;</span>;
<a name="l00378"></a>00378         } elseif( strncmp(<span class="stringliteral">&apos;LLL:&apos;</span>, $label, 4) === 0 ) {
<a name="l00379"></a>00379             $labelKey = substr($label, 4);
<a name="l00380"></a>00380             <span class="keywordflow">return</span> <a class="code" href="class_todoyu_div.html#a71fad5548fe188ea7853db0d5337e43b">TodoyuLocale::getLabel</a>($labelKey, $locale);
<a name="l00381"></a>00381         } <span class="keywordflow">else</span> {
<a name="l00382"></a>00382             <span class="keywordflow">return</span> $label;
<a name="l00383"></a>00383         }
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 
<a name="l00395"></a><a class="code" href="class_todoyu_div.html#afb2212b547536d5752dc1757b8de4092">00395</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#afb2212b547536d5752dc1757b8de4092">pathWeb</a>($absolutePath) {
<a name="l00396"></a>00396         <span class="keywordflow">return</span> <a class="code" href="class_todoyu_div.html#afb2212b547536d5752dc1757b8de4092">TodoyuFileManager::pathWeb</a>($absolutePath);
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 
<a name="l00407"></a><a class="code" href="class_todoyu_div.html#a628c8acff4824988f7b509e0615db33d">00407</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a628c8acff4824988f7b509e0615db33d">isAllowedTodoyuPath</a>(<a class="code" href="erni_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>) {
<a name="l00408"></a>00408         <a class="code" href="erni_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>   = <a class="code" href="class_todoyu_file_manager.html#aa39c49d884a7e1f0b7fcd7fa7d5638a3">TodoyuFileManager::pathAbsolute</a>(<a class="code" href="erni_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>);
<a name="l00409"></a>00409 
<a name="l00410"></a>00410         <span class="keywordflow">return</span> stripos(<a class="code" href="erni_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>, <a class="code" href="core_2config_2constants_8php.html#a98e6ec34047e8d89ccc3884beede053a">PATH</a>) === 0;
<a name="l00411"></a>00411     }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 
<a name="l00426"></a><a class="code" href="class_todoyu_div.html#a618b9b535b85e590f0759a8fbae4a3d3">00426</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a618b9b535b85e590f0759a8fbae4a3d3">cropText</a>($text, $length, $postfix = <span class="stringliteral">&apos;...&apos;</span>, $dontSplitWords = <span class="keyword">true</span>) {
<a name="l00427"></a>00427         $text   = trim($text);
<a name="l00428"></a>00428         $length = intval($length);
<a name="l00429"></a>00429 
<a name="l00430"></a>00430         <span class="keywordflow">if</span>( mb_strlen($text) &gt; $length ) {
<a name="l00431"></a>00431             $cropped    = mb_substr($text, 0, $length);
<a name="l00432"></a>00432             $nextChar   = mb_substr($text, $length, 1);
<a name="l00433"></a>00433 
<a name="l00434"></a>00434             <span class="keywordflow">if</span>( $dontSplitWords === <span class="keyword">true</span> &amp;&amp; $nextChar !== <span class="charliteral">&apos; &apos;</span> ) {
<a name="l00435"></a>00435                 $spacePos   = mb_strpos($cropped, <span class="charliteral">&apos; &apos;</span>);
<a name="l00436"></a>00436                 $cropped    = mb_substr($cropped, 0, $spacePos);
<a name="l00437"></a>00437             }
<a name="l00438"></a>00438 
<a name="l00439"></a>00439             $cropped .= $postfix;
<a name="l00440"></a>00440         } <span class="keywordflow">else</span> {
<a name="l00441"></a>00441             $cropped = $text;
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444         <span class="keywordflow">return</span> $cropped;
<a name="l00445"></a>00445     }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 
<a name="l00459"></a><a class="code" href="class_todoyu_div.html#a5351819ab7ad24771d66186da4f13f4a">00459</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a5351819ab7ad24771d66186da4f13f4a">addToList</a>($list, $value, $separator = <span class="charliteral">&apos;,&apos;</span>, $unique = <span class="keyword">false</span>) {
<a name="l00460"></a>00460         $items  = explode($separator, $list);
<a name="l00461"></a>00461         $items[]= $value;
<a name="l00462"></a>00462 
<a name="l00463"></a>00463         <span class="keywordflow">if</span>( $unique ) {
<a name="l00464"></a>00464             $items = array_unique($items);
<a name="l00465"></a>00465         }
<a name="l00466"></a>00466 
<a name="l00467"></a>00467         <span class="keywordflow">return</span> implode($separator, $items);
<a name="l00468"></a>00468     }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 
<a name="l00479"></a><a class="code" href="class_todoyu_div.html#a5b9a6a97e28049726fd2cbb59951b95c">00479</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a5b9a6a97e28049726fd2cbb59951b95c">isFile</a>(<a class="code" href="erni_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>) {
<a name="l00480"></a>00480         <span class="keywordflow">return</span> is_file( <a class="code" href="class_todoyu_file_manager.html#aa39c49d884a7e1f0b7fcd7fa7d5638a3">TodoyuFileManager::pathAbsolute</a>(<a class="code" href="erni_8php.html#a0a4baf0b22973c07685c3981f0d17fc4">$path</a>) );
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 
<a name="l00492"></a><a class="code" href="class_todoyu_div.html#a54a5b86c25481904dc54b5ab4a29dab8">00492</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a54a5b86c25481904dc54b5ab4a29dab8">makeCleanFilename</a>($dirtyFilename) {
<a name="l00493"></a>00493         <span class="keywordflow">return</span> <a class="code" href="class_todoyu_div.html#a54a5b86c25481904dc54b5ab4a29dab8">TodoyuFileManager::makeCleanFilename</a>($dirtyFilename, <span class="charliteral">&apos;_&apos;</span>);
<a name="l00494"></a>00494     }
<a name="l00495"></a>00495 
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 
<a name="l00506"></a><a class="code" href="class_todoyu_div.html#af950e2ae7320e325dcf0e03ae20bd617">00506</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#af950e2ae7320e325dcf0e03ae20bd617">formatSize</a>($filesize, array $labels = null, $noLabel = <span class="keyword">false</span>) {
<a name="l00507"></a>00507         $filesize   = intval($filesize);
<a name="l00508"></a>00508 
<a name="l00509"></a>00509         <span class="keywordflow">if</span>( is_null($labels) ) {
<a name="l00510"></a>00510             <span class="keywordflow">if</span>( $noLabel === <span class="keyword">false</span> ) {
<a name="l00511"></a>00511                 $labels = array(
<a name="l00512"></a>00512                     <span class="stringliteral">&apos;gb&apos;</span>    =&gt; <a class="code" href="functions_8php.html#a7c072b45376ab4eab800bc4788a4e22f">Label</a>(<span class="stringliteral">&apos;file.size.gb&apos;</span>),
<a name="l00513"></a>00513                     <span class="stringliteral">&apos;mb&apos;</span>    =&gt; <a class="code" href="functions_8php.html#a7c072b45376ab4eab800bc4788a4e22f">Label</a>(<span class="stringliteral">&apos;file.size.mb&apos;</span>),
<a name="l00514"></a>00514                     <span class="stringliteral">&apos;kb&apos;</span>    =&gt; <a class="code" href="functions_8php.html#a7c072b45376ab4eab800bc4788a4e22f">Label</a>(<span class="stringliteral">&apos;file.size.kb&apos;</span>),
<a name="l00515"></a>00515                     <span class="charliteral">&apos;b&apos;</span>     =&gt; <a class="code" href="functions_8php.html#a7c072b45376ab4eab800bc4788a4e22f">Label</a>(<span class="stringliteral">&apos;file.size.b&apos;</span>)
<a name="l00516"></a>00516                 );
<a name="l00517"></a>00517             } <span class="keywordflow">else</span> {
<a name="l00518"></a>00518                 $labels = array();
<a name="l00519"></a>00519             }
<a name="l00520"></a>00520         }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522         <span class="keywordflow">if</span>( $filesize &gt; 1000000000 ) {      <span class="comment">// GB</span>
<a name="l00523"></a>00523             $size   = $filesize / (1024 * 1024 * 1024);
<a name="l00524"></a>00524             $label  = $labels[<span class="stringliteral">&apos;gb&apos;</span>];
<a name="l00525"></a>00525         } elseif( $filesize &gt; 1000000 ) {
<a name="l00526"></a>00526             $size   = $filesize / (1024 * 1024);
<a name="l00527"></a>00527             $label  = $labels[<span class="stringliteral">&apos;mb&apos;</span>];
<a name="l00528"></a>00528         } elseif( $filesize &gt; 1000 ) {
<a name="l00529"></a>00529             $size   = $filesize / 1024;
<a name="l00530"></a>00530             $label  = $labels[<span class="stringliteral">&apos;kb&apos;</span>];
<a name="l00531"></a>00531         } <span class="keywordflow">else</span> {
<a name="l00532"></a>00532             $size   = $filesize;
<a name="l00533"></a>00533             $label  = $labels[<span class="charliteral">&apos;b&apos;</span>];
<a name="l00534"></a>00534         }
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         $dez    = $size &gt;= 10 ? 0 : 1;
<a name="l00537"></a>00537 
<a name="l00538"></a>00538         <span class="keywordflow">return</span> number_format($size, $dez, <span class="charliteral">&apos;.&apos;</span>, <span class="stringliteral">&apos;&apos;</span>) . ( $noLabel ? <span class="stringliteral">&apos;&apos;</span> : <span class="charliteral">&apos; &apos;</span> . $label);
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 
<a name="l00542"></a>00542 
<a name="l00551"></a><a class="code" href="class_todoyu_div.html#aa8ad0474029e7dc6739b0596b949638c">00551</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#aa8ad0474029e7dc6739b0596b949638c">sendFile</a>($absoluteFilePath) {
<a name="l00552"></a>00552         $absoluteFilePath   = realpath($absoluteFilePath);
<a name="l00553"></a>00553 
<a name="l00554"></a>00554         <span class="keywordflow">if</span>( $absoluteFilePath !== <span class="keyword">false</span> ) {
<a name="l00555"></a>00555             <span class="keywordflow">if</span>( is_readable($absoluteFilePath) ) {
<a name="l00556"></a>00556                 <span class="keywordflow">if</span>( self::isFileInAllowedDownloadPath($absoluteFilePath) ) {
<a name="l00557"></a>00557                     $fp = fopen($absoluteFilePath, <span class="stringliteral">&apos;rb&apos;</span>);
<a name="l00558"></a>00558 
<a name="l00559"></a>00559                     <span class="keywordflow">while</span>(<a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a> = fread($fp, 1024)) {
<a name="l00560"></a>00560                         echo <a class="code" href="projectrole_8php.html#a52040912826b490efa3dd0e7f42e1c3f">$data</a>;
<a name="l00561"></a>00561                     }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563                     fclose($fp);
<a name="l00564"></a>00564 
<a name="l00565"></a>00565                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00566"></a>00566                 } <span class="keywordflow">else</span> {
<a name="l00567"></a>00567                     <a class="code" href="class_todoyu.html#ac43531f7e0c334e68104bb1942eee286">Todoyu::log</a>(<span class="stringliteral">&apos;Tried to download a file from a not allowed path&apos;</span>, <a class="code" href="core_2config_2constants_8php.html#accd74311a7a86c9dd9ec5ed2338072eb">LOG_LEVEL_SECURITY</a>, $absoluteFilePath);
<a name="l00568"></a>00568                 }
<a name="l00569"></a>00569             }
<a name="l00570"></a>00570         }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00573"></a>00573     }
<a name="l00574"></a>00574 
<a name="l00575"></a>00575 
<a name="l00576"></a>00576 
<a name="l00586"></a><a class="code" href="class_todoyu_div.html#a485da36423c1c0bfb961b312072c6ba0">00586</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a485da36423c1c0bfb961b312072c6ba0">isFileInAllowedDownloadPath</a>($absoluteFilePath) {
<a name="l00587"></a>00587         $absoluteFilePath   = realpath($absoluteFilePath);
<a name="l00588"></a>00588         $disallowedPaths    = <a class="code" href="filterwidgetconf_8php.html#a5256d5171498a1b9833f7a1fc459aa2f">$GLOBALS</a>[<span class="stringliteral">&apos;CONFIG&apos;</span>][<span class="stringliteral">&apos;sendFile&apos;</span>][<span class="stringliteral">&apos;disallow&apos;</span>];
<a name="l00589"></a>00589         $allowedPaths       = <a class="code" href="filterwidgetconf_8php.html#a5256d5171498a1b9833f7a1fc459aa2f">$GLOBALS</a>[<span class="stringliteral">&apos;CONFIG&apos;</span>][<span class="stringliteral">&apos;sendFile&apos;</span>][<span class="stringliteral">&apos;allow&apos;</span>];
<a name="l00590"></a>00590 
<a name="l00591"></a>00591         <span class="comment">// If file exists</span>
<a name="l00592"></a>00592         <span class="keywordflow">if</span>( $absoluteFilePath !== <span class="keyword">false</span> ) {
<a name="l00593"></a>00593 
<a name="l00594"></a>00594             <span class="comment">// Check if file is in an explicitly disallowed path</span>
<a name="l00595"></a>00595             <span class="keywordflow">if</span>( is_array($disallowedPaths) ) {
<a name="l00596"></a>00596                 <span class="keywordflow">foreach</span>($disallowedPaths as $disallowedPath) {
<a name="l00597"></a>00597                     <span class="keywordflow">if</span>( strpos($absoluteFilePath, $disallowedPath) !== <span class="keyword">false</span> ) {
<a name="l00598"></a>00598 
<a name="l00599"></a>00599                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00600"></a>00600                     }
<a name="l00601"></a>00601                 }
<a name="l00602"></a>00602             }
<a name="l00603"></a>00603             <span class="comment">// Check if file is in an allowed path</span>
<a name="l00604"></a>00604             <span class="keywordflow">if</span>( is_array($allowedPaths) ) {
<a name="l00605"></a>00605                 <span class="keywordflow">foreach</span>($allowedPaths as $allowedPath) {
<a name="l00606"></a>00606                     <span class="keywordflow">if</span>( strpos($absoluteFilePath, $allowedPath) !== <span class="keyword">false</span> ) {
<a name="l00607"></a>00607                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00608"></a>00608                     }
<a name="l00609"></a>00609                 }
<a name="l00610"></a>00610             }
<a name="l00611"></a>00611         }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 
<a name="l00614"></a>00614 
<a name="l00615"></a>00615         <span class="comment">// If file not found, or no allowing config available, disallow download</span>
<a name="l00616"></a>00616         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618 
<a name="l00619"></a>00619 
<a name="l00626"></a><a class="code" href="class_todoyu_div.html#a88af1d686e209fbfcbaddc9ae45fafd1">00626</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a88af1d686e209fbfcbaddc9ae45fafd1">wrapScript</a>($jsCode) {
<a name="l00627"></a>00627         <span class="keywordflow">return</span> <span class="stringliteral">&apos;&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&gt;&apos;</span> . $jsCode . <span class="stringliteral">&apos;&lt;/script&gt;&apos;</span>;
<a name="l00628"></a>00628     }
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 
<a name="l00637"></a><a class="code" href="class_todoyu_div.html#ad6d480a3faa4fe1e10c9ea2d744dbb8b">00637</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#ad6d480a3faa4fe1e10c9ea2d744dbb8b">md5short</a>($string) {
<a name="l00638"></a>00638         <span class="keywordflow">return</span> substr(md5($string), 0, 10);
<a name="l00639"></a>00639     }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641 
<a name="l00642"></a>00642 
<a name="l00652"></a><a class="code" href="class_todoyu_div.html#a8c99fb6b0d2453efe6fe7e3aa52ea07d">00652</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a8c99fb6b0d2453efe6fe7e3aa52ea07d">getSubstring</a>($string, $keyword, $charsBefore = 20, $charsAfter = 20, $htmlEntities = <span class="keyword">true</span>) {
<a name="l00653"></a>00653         $charsBefore= intval($charsBefore);
<a name="l00654"></a>00654         $charsAfter = intval($charsAfter);
<a name="l00655"></a>00655         $keyLen     = strlen(trim($keyword));
<a name="l00656"></a>00656         $pos        = stripos($string, $keyword);
<a name="l00657"></a>00657         $start      = <a class="code" href="class_todoyu_div.html#a54662513802f01f2e5cfd7ee936f0bab">TodoyuDiv::intInRange</a>($pos-$charsBefore, 0);
<a name="l00658"></a>00658         $subLen     = $charsBefore + $keyLen + $charsAfter;
<a name="l00659"></a>00659 
<a name="l00660"></a>00660         <span class="keywordflow">if</span>( $htmlEntities ) {
<a name="l00661"></a>00661             $string = htmlentities(substr(html_entity_decode($string), $start, $subLen));
<a name="l00662"></a>00662         } <span class="keywordflow">else</span> {
<a name="l00663"></a>00663             $string = substr($string, $start, $subLen);
<a name="l00664"></a>00664         }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666         <span class="keywordflow">return</span> $string;
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669 
<a name="l00670"></a>00670 
<a name="l00679"></a><a class="code" href="class_todoyu_div.html#afcc9d79cf22888569ba5f634bb686d1c">00679</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#afcc9d79cf22888569ba5f634bb686d1c">callUserFunction</a>($funcRef) {
<a name="l00680"></a>00680         $funcArgs   = func_get_args();
<a name="l00681"></a>00681         $funcRef    = array_shift($funcArgs);
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         <span class="keywordflow">if</span>( self::isFunctionReference($funcRef) ) {
<a name="l00684"></a>00684             $funcRef = explode(<span class="stringliteral">&apos;::&apos;</span>, $funcRef);
<a name="l00685"></a>00685 
<a name="l00686"></a>00686             $result = call_user_func_array($funcRef, $funcArgs);
<a name="l00687"></a>00687         } <span class="keywordflow">else</span> {
<a name="l00688"></a>00688             $result = <span class="keyword">false</span>;
<a name="l00689"></a>00689         }
<a name="l00690"></a>00690 
<a name="l00691"></a>00691         <span class="keywordflow">return</span> $result;
<a name="l00692"></a>00692     }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694 
<a name="l00695"></a>00695 
<a name="l00705"></a><a class="code" href="class_todoyu_div.html#a3ec33b8de8338b2078f3e55be2daea71">00705</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a3ec33b8de8338b2078f3e55be2daea71">callUserFunctionArray</a>($funcRef, array $funcArgs) {
<a name="l00706"></a>00706         <span class="keywordflow">if</span>( self::isFunctionReference($funcRef) ) {
<a name="l00707"></a>00707             $funcRef = explode(<span class="stringliteral">&apos;::&apos;</span>, $funcRef);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709             $result = call_user_func_array($funcRef, $funcArgs);
<a name="l00710"></a>00710         } <span class="keywordflow">else</span> {
<a name="l00711"></a>00711             <a class="code" href="class_todoyu_debug.html#adc1d20befc0f0af3f20834265b0f81ac">TodoyuDebug::printInFirebug</a>($funcRef, <span class="stringliteral">&apos;Function not found&apos;</span>);
<a name="l00712"></a>00712             $result = <span class="keyword">false</span>;
<a name="l00713"></a>00713         }
<a name="l00714"></a>00714 
<a name="l00715"></a>00715         <span class="keywordflow">return</span> $result;
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718 
<a name="l00719"></a>00719 
<a name="l00726"></a><a class="code" href="class_todoyu_div.html#a2dbf9fd5046506735124e644c99d2f96">00726</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a2dbf9fd5046506735124e644c99d2f96">isFunctionReference</a>($funcRefString) {
<a name="l00727"></a>00727         <span class="keywordflow">if</span>( strpos($funcRefString, <span class="stringliteral">&apos;::&apos;</span>) === <span class="keyword">false</span> ) {
<a name="l00728"></a>00728             <span class="keywordflow">return</span> function_exists($funcRefString);
<a name="l00729"></a>00729         } <span class="keywordflow">else</span> {
<a name="l00730"></a>00730             $parts  = explode(<span class="stringliteral">&apos;::&apos;</span>, $funcRefString);
<a name="l00731"></a>00731 
<a name="l00732"></a>00732             <span class="keywordflow">return</span> method_exists($parts[0], $parts[1]);
<a name="l00733"></a>00733         }
<a name="l00734"></a>00734     }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 
<a name="l00746"></a><a class="code" href="class_todoyu_div.html#a2d41422e7370fe95e19b13d4c1519f81">00746</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a2d41422e7370fe95e19b13d4c1519f81">isInList</a>(<a class="code" href="validator_8php.html#aa61b415cee119a7511e05c405ecd0b32">$item</a>, $listString, $listSeperator = <span class="charliteral">&apos;,&apos;</span>)   {
<a name="l00747"></a>00747         $list   = explode($listSeperator, $listString);
<a name="l00748"></a>00748 
<a name="l00749"></a>00749         <span class="keywordflow">return</span> in_array(<a class="code" href="validator_8php.html#aa61b415cee119a7511e05c405ecd0b32">$item</a>, $list);
<a name="l00750"></a>00750     }
<a name="l00751"></a>00751 
<a name="l00752"></a>00752 
<a name="l00753"></a>00753 
<a name="l00761"></a><a class="code" href="class_todoyu_div.html#a12686580bfd45b9d4d914f6992adeb80">00761</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a12686580bfd45b9d4d914f6992adeb80">getIntVersion</a>($version) {
<a name="l00762"></a>00762         <span class="keywordflow">if</span> (!preg_match(<span class="stringliteral">&apos;/^(\d+)\.(\d+)\.(\d+)(?:(?:\.|-(rc|dev|beta|alpha))(\d+)?)?$/&apos;</span>, $version, $matches)) {
<a name="l00763"></a>00763             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765 
<a name="l00766"></a>00766         <span class="comment">// Increase value for subversions</span>
<a name="l00767"></a>00767         <span class="keywordflow">if</span>( ! empty($matches[4]) ) {
<a name="l00768"></a>00768             <span class="keywordflow">switch</span> ($matches[4]) {
<a name="l00769"></a>00769                 <span class="keywordflow">case</span> <span class="stringliteral">&apos;rc&apos;</span>:
<a name="l00770"></a>00770                     $added = 30;
<a name="l00771"></a>00771                     <span class="keywordflow">break</span>;
<a name="l00772"></a>00772 
<a name="l00773"></a>00773 
<a name="l00774"></a>00774                 <span class="keywordflow">case</span> <span class="stringliteral">&apos;beta&apos;</span>:
<a name="l00775"></a>00775                     $added = 20;
<a name="l00776"></a>00776                     <span class="keywordflow">break</span>;
<a name="l00777"></a>00777 
<a name="l00778"></a>00778 
<a name="l00779"></a>00779                 <span class="keywordflow">case</span> <span class="stringliteral">&apos;alpha&apos;</span>:
<a name="l00780"></a>00780                     $added = 10;
<a name="l00781"></a>00781                     <span class="keywordflow">break</span>;
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 
<a name="l00784"></a>00784                 <span class="keywordflow">case</span> <span class="stringliteral">&apos;dev&apos;</span>:
<a name="l00785"></a>00785                     $added = 0;
<a name="l00786"></a>00786                     <span class="keywordflow">break</span>;
<a name="l00787"></a>00787             }
<a name="l00788"></a>00788         } <span class="keywordflow">else</span> {
<a name="l00789"></a>00789             $added = 50; <span class="comment">// for final</span>
<a name="l00790"></a>00790         }
<a name="l00791"></a>00791         <span class="comment">// Add version of subversion (ex: alpha3 = +3)</span>
<a name="l00792"></a>00792         <span class="keywordflow">if</span>( ! empty($matches[5]) ) {
<a name="l00793"></a>00793             $added = $added + $matches[5];
<a name="l00794"></a>00794         }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796         <span class="keywordflow">return</span> $matches[1] * 1000000 + $matches[2] * 10000 + $matches[3] * 100 + $added;
<a name="l00797"></a>00797     }
<a name="l00798"></a>00798 
<a name="l00799"></a>00799 
<a name="l00800"></a>00800 
<a name="l00810"></a><a class="code" href="class_todoyu_div.html#a4fc6633bfa33b5463c7459f2d68bacec">00810</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a4fc6633bfa33b5463c7459f2d68bacec">wrapString</a>($string, $wrap)   {
<a name="l00811"></a>00811         <span class="keywordflow">return</span> <a class="code" href="javascript_8js.html#a653ea8da4d112c6bce1135d086cb38c9">str_replace</a>(<span class="charliteral">&apos;|&apos;</span>, $string, $wrap);
<a name="l00812"></a>00812     }
<a name="l00813"></a>00813 
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 
<a name="l00823"></a><a class="code" href="class_todoyu_div.html#a56b3698d12180c3bd6d66059468f13c8">00823</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a56b3698d12180c3bd6d66059468f13c8">useFieldAsIndex</a>(array $array, $fieldname) {
<a name="l00824"></a>00824         $new = array();
<a name="l00825"></a>00825 
<a name="l00826"></a>00826         <span class="keywordflow">foreach</span>($array as $index =&gt; <a class="code" href="validator_8php.html#aa61b415cee119a7511e05c405ecd0b32">$item</a>) {
<a name="l00827"></a>00827             <a class="code" href="validator_8php.html#aa61b415cee119a7511e05c405ecd0b32">$item</a>[<span class="stringliteral">&apos;_oldIndex&apos;</span>] = $index;
<a name="l00828"></a>00828             $new[<a class="code" href="validator_8php.html#aa61b415cee119a7511e05c405ecd0b32">$item</a>[$fieldname]] = $item;
<a name="l00829"></a>00829         }
<a name="l00830"></a>00830 
<a name="l00831"></a>00831         <span class="keywordflow">return</span> $new;
<a name="l00832"></a>00832     }
<a name="l00833"></a>00833 
<a name="l00834"></a>00834 
<a name="l00835"></a>00835 
<a name="l00842"></a><a class="code" href="class_todoyu_div.html#ad198e9a1665f721a41973ed1ac40e01f">00842</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#ad198e9a1665f721a41973ed1ac40e01f">explodeCamelCase</a>($camelCaseString) {
<a name="l00843"></a>00843         $spaced = preg_replace( <span class="stringliteral">&apos;/([a-z0-9])([A-Z])/&apos;</span>, <span class="stringliteral">&quot;$1 $2&quot;</span>, $camelCaseString);
<a name="l00844"></a>00844 
<a name="l00845"></a>00845         <span class="keywordflow">return</span> explode(<span class="charliteral">&apos; &apos;</span>, $spaced);
<a name="l00846"></a>00846     }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848 
<a name="l00849"></a>00849 
<a name="l00858"></a><a class="code" href="class_todoyu_div.html#a77aa1b7374b241b7349345489a6a579f">00858</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a77aa1b7374b241b7349345489a6a579f">buildUrl</a>(array $params = array(), $hash = <span class="stringliteral">&apos;&apos;</span>, $absolute = <span class="keyword">false</span>) {
<a name="l00859"></a>00859         $query      = <a class="code" href="core_2config_2constants_8php.html#a5ecb5f087b75ab4e06e53cc5417df2aa">PATH_WEB</a> . (<a class="code" href="core_2config_2constants_8php.html#a5ecb5f087b75ab4e06e53cc5417df2aa">PATH_WEB</a> === <span class="charliteral">&apos;/&apos;</span> ? <span class="charliteral">&apos;?&apos;</span> : <span class="stringliteral">&apos;/?&apos;</span>);
<a name="l00860"></a>00860         $queryParts = array();
<a name="l00861"></a>00861 
<a name="l00862"></a>00862         <span class="comment">// Add all parameters encoded</span>
<a name="l00863"></a>00863         <span class="keywordflow">foreach</span>($params as $name =&gt; $value) {
<a name="l00864"></a>00864             $queryParts[] = $name . <span class="charliteral">&apos;=&apos;</span> . urlencode($value);
<a name="l00865"></a>00865         }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867         <span class="comment">// Concatinate</span>
<a name="l00868"></a>00868         $query .= implode(<span class="charliteral">&apos;&amp;&apos;</span>, $queryParts);
<a name="l00869"></a>00869 
<a name="l00870"></a>00870         <span class="comment">// Add hash</span>
<a name="l00871"></a>00871         <span class="keywordflow">if</span>( ! empty($hash) ) {
<a name="l00872"></a>00872             $query .= <span class="charliteral">&apos;#&apos;</span> . $hash;
<a name="l00873"></a>00873         }
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="keywordflow">if</span>( $absolute ) {
<a name="l00876"></a>00876             $query = <a class="code" href="core_2config_2constants_8php.html#afa57909d198b8bea4efb05e286a537ea">SERVER_URL</a> . substr($query, 1);
<a name="l00877"></a>00877         }
<a name="l00878"></a>00878 
<a name="l00879"></a>00879         <span class="keywordflow">return</span> $query;
<a name="l00880"></a>00880     }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882 
<a name="l00883"></a>00883 
<a name="l00888"></a>00888     <span class="keyword">private</span> <span class="keyword">static</span> function initMcrypt() {
<a name="l00889"></a>00889         <span class="keywordflow">if</span>( is_null(self::$mcrypt) ) {
<a name="l00890"></a>00890             <span class="comment">// Open module</span>
<a name="l00891"></a>00891             self::$mcrypt = mcrypt_module_open(<span class="stringliteral">&apos;tripledes&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;ecb&apos;</span>, <span class="stringliteral">&apos;&apos;</span>);
<a name="l00892"></a>00892             <span class="comment">// Random seed</span>
<a name="l00893"></a>00893             $random = 596328;
<a name="l00894"></a>00894             <span class="comment">// Generate initialisation vector</span>
<a name="l00895"></a>00895             $vector = mcrypt_create_iv(mcrypt_enc_get_iv_size(self::$mcrypt), $random);
<a name="l00896"></a>00896             <span class="comment">// Get the expected key size based on mode and cipher</span>
<a name="l00897"></a>00897             $expectedKeySize = mcrypt_enc_get_key_size(self::$mcrypt);
<a name="l00898"></a>00898             <span class="comment">// Get a key in the needed length (use typo3 key)</span>
<a name="l00899"></a>00899             $key = substr(<a class="code" href="filterwidgetconf_8php.html#a5256d5171498a1b9833f7a1fc459aa2f">$GLOBALS</a>[<span class="stringliteral">&apos;CONFIG&apos;</span>][<span class="stringliteral">&apos;SYSTEM&apos;</span>][<span class="stringliteral">&apos;encryptionKey&apos;</span>], 0, $expectedKeySize);
<a name="l00900"></a>00900             <span class="comment">// Initialize mcrypt library with mode/cipher, encryption key, and random initialization vector</span>
<a name="l00901"></a>00901             mcrypt_generic_init(self::$mcrypt, $key, $vector);
<a name="l00902"></a>00902         }
<a name="l00903"></a>00903     }
<a name="l00904"></a>00904 
<a name="l00905"></a>00905 
<a name="l00906"></a>00906 
<a name="l00913"></a><a class="code" href="class_todoyu_div.html#a6c25d847040b38831c8e98e152cae77d">00913</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a6c25d847040b38831c8e98e152cae77d">encrypt</a>($input) {
<a name="l00914"></a>00914         self::initMcrypt();
<a name="l00915"></a>00915 
<a name="l00916"></a>00916         $stringToEncrypt    = serialize($input);
<a name="l00917"></a>00917         $encryptedString    = mcrypt_generic(self::$mcrypt, $stringToEncrypt);
<a name="l00918"></a>00918 
<a name="l00919"></a>00919         <span class="keywordflow">return</span> base64_encode($encryptedString);
<a name="l00920"></a>00920     }
<a name="l00921"></a>00921 
<a name="l00922"></a>00922 
<a name="l00923"></a>00923 
<a name="l00930"></a><a class="code" href="class_todoyu_div.html#a5cba6f4a8390f3e9202cd46ebca3bec3">00930</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a5cba6f4a8390f3e9202cd46ebca3bec3">decrypt</a>($encryptedString) {
<a name="l00931"></a>00931         self::initMcrypt();
<a name="l00932"></a>00932 
<a name="l00933"></a>00933         $encryptedString    = base64_decode($encryptedString);
<a name="l00934"></a>00934         $decryptedString    = mdecrypt_generic(self::$mcrypt, $encryptedString);
<a name="l00935"></a>00935 
<a name="l00936"></a>00936         <span class="keywordflow">return</span> unserialize($decryptedString);
<a name="l00937"></a>00937     }
<a name="l00938"></a>00938 
<a name="l00939"></a>00939 
<a name="l00940"></a>00940 
<a name="l00948"></a><a class="code" href="class_todoyu_div.html#a2605cd002deb073cebad634d3eef8d57">00948</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#a2605cd002deb073cebad634d3eef8d57">splitCamelCase</a>($string) {
<a name="l00949"></a>00949         <span class="keywordflow">return</span> preg_split(<span class="stringliteral">&apos;/([A-Z][^A-Z]*)/&apos;</span>, $string, -1, PREG_SPLIT_NO_EMPTY | PREG_SPLIT_DELIM_CAPTURE);
<a name="l00950"></a>00950     }
<a name="l00951"></a>00951 
<a name="l00952"></a>00952 
<a name="l00953"></a>00953 
<a name="l00960"></a><a class="code" href="class_todoyu_div.html#ae4d905644df45b43442bb9a0b506c4d1">00960</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="class_todoyu_div.html#ae4d905644df45b43442bb9a0b506c4d1">getVersionInfo</a>($versionString) {
<a name="l00961"></a>00961         $info           = array();
<a name="l00962"></a>00962 
<a name="l00963"></a>00963         <span class="keywordflow">if</span>( strpos($versionString, <span class="charliteral">&apos;-&apos;</span>) !== <span class="keyword">false</span> ) {
<a name="l00964"></a>00964             $temp   = explode(<span class="charliteral">&apos;-&apos;</span>, $versionString);
<a name="l00965"></a>00965             $version= explode(<span class="charliteral">&apos;.&apos;</span>, $temp[0]);
<a name="l00966"></a>00966             $status = $temp[1];
<a name="l00967"></a>00967         } <span class="keywordflow">else</span> {
<a name="l00968"></a>00968             $version= explode(<span class="charliteral">&apos;.&apos;</span>, $versionString);
<a name="l00969"></a>00969             $status = <span class="stringliteral">&apos;stable&apos;</span>;
<a name="l00970"></a>00970         }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972         $info[<span class="stringliteral">&apos;major&apos;</span>]      = intval($version[0]);
<a name="l00973"></a>00973         $info[<span class="stringliteral">&apos;minor&apos;</span>]      = intval($version[1]);
<a name="l00974"></a>00974         $info[<span class="stringliteral">&apos;revision&apos;</span>]   = intval($version[2]);
<a name="l00975"></a>00975         $info[<span class="stringliteral">&apos;status&apos;</span>]     = $status;
<a name="l00976"></a>00976 
<a name="l00977"></a>00977         <span class="keywordflow">return</span> $info;
<a name="l00978"></a>00978     }
<a name="l00979"></a>00979 
<a name="l00980"></a>00980 }
<a name="l00981"></a>00981 
<a name="l00982"></a>00982 ?&gt;
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Erzeugt am Tue Dec 1 18:32:31 2009 f√ºr Todoyu von&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
